<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª…ì–¸ ì´ë¯¸ì§€ ìƒì„±ê¸°</title>
    
    <!-- 
    íŒŒì¼ êµ¬ì¡°:
    /
    â”œâ”€â”€ index.html
    â”œâ”€â”€ fonts.js
    â”œâ”€â”€ quotes/
    â”‚   â””â”€â”€ good.json
    â””â”€â”€ gofit_logo/
        â””â”€â”€ LOGO.png
    -->
    
    <!-- í°íŠ¸ ë¡œë”© ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="fonts.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ë¡œ ë³€ê²½ */
            justify-content: center;
            padding: 50px 20px 20px 20px; /* ìƒë‹¨ì— ì—¬ë°± ì¶”ê°€ */
            color: #e0e0e0;
            overflow-y: auto;
        }

        .container {
            background: #1a1a1a;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), 0 0 100px rgba(138, 43, 226, 0.1);
            padding: 40px;
            max-width: 1400px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 40px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #8a2be2 0%, #4169e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .generator-wrapper {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
            min-height: 800px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
            padding-bottom: 150px; /* í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ */
        }

        .left-section {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
        }

        .canvas-container {
            position: relative;
            margin-bottom: 30px;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            display: flex;
            opacity: 1;
        }

        .loading-content {
            text-align: center;
            color: #fff;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 30px;
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: #8a2be2;
            border-right-color: #8a2be2;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 22px;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 2px 10px rgba(138, 43, 226, 0.8);
            animation: pulse 1.5s ease-in-out infinite;
            letter-spacing: 0.5px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        canvas {
            width: 100%;
            height: auto;
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 16px;
            display: block;
            background: #2a2a2a;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        canvas:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(138, 43, 226, 0.2);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .button-group.single {
            grid-template-columns: 1fr;
        }

        .button-group.triple {
            grid-template-columns: repeat(3, 1fr);
        }

        button {
            padding: 15px 20px;
            background: linear-gradient(135deg, #8a2be2 0%, #4169e1 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button.secondary {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }

        button.secondary:hover {
            background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.3);
        }

        button:hover::before {
            left: 100%;
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        button:disabled::before {
            display: none;
        }

        .controls {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            overflow: visible; /* ë“œë¡­ë‹¤ìš´ì´ ì»¨í…Œì´ë„ˆ ë°–ìœ¼ë¡œ ë‚˜ê°ˆ ìˆ˜ ìˆë„ë¡ */
        }

        .control-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            overflow: visible; /* ë“œë¡­ë‹¤ìš´ì„ ìœ„í•´ ì¶”ê°€ */
        }

        .control-section:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(138, 43, 226, 0.3);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #8a2be2;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group {
            margin-bottom: 20px;
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        label {
            display: block;
            font-weight: 600;
            color: #b0b0b0;
            margin-bottom: 10px;
            transition: color 0.3s ease;
            font-size: 14px;
        }

        .control-group:hover label {
            color: #8a2be2;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            transition: all 0.3s ease;
        }
        
        /* select ìš”ì†Œ ì¶”ê°€ ìŠ¤íƒ€ì¼ - ë“œë¡­ë‹¤ìš´ ë°©í–¥ ì œì–´ */
        select {
            position: relative;
            z-index: 999;
        }
        
        /* í°íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ íŠ¹ë³„ ì²˜ë¦¬ */
        #fontFamily {
            max-height: none; /* ë†’ì´ ì œí•œ ì œê±° */
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8a2be2;
            background: rgba(138, 43, 226, 0.1);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.2);
        }

        input:disabled, select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input[type="color"] {
            height: 50px;
            cursor: pointer;
            padding: 5px;
        }

        input[type="range"] {
            padding: 0;
            background: transparent;
        }

        input[type="range"]::-webkit-slider-track {
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #8a2be2;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #8a2be2;
            vertical-align: middle;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label span {
            margin-left: 10px;
        }

        @media (max-width: 992px) {
            .generator-wrapper {
                flex-direction: column;
                gap: 30px;
            }

            .left-section, .controls {
                max-width: 100%;
            }

            .button-group.triple {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .control-section {
                padding: 20px;
            }

            .button-group {
                grid-template-columns: 1fr;
            }
        }

        option {
            background: #2a2a2a;
            color: #e0e0e0;
        }

        optgroup {
            background: #4a2c7a;
            color: #fff;
            font-weight: bold;
        }

        /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ ëª…ì–¸ ì´ë¯¸ì§€ ìƒì„±ê¸°</h1>
        
        <div class="generator-wrapper">
            <div class="left-section">
                <div class="canvas-container">
                    <canvas id="canvas" width="1000" height="1000"></canvas>
                    <div class="loading-overlay" id="loading">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="loading-dots"></span></div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button onclick="generateNewCombination()">ğŸ² ëœë¤ ì¡°í•©</button>
                    <button onclick="downloadImage()">ğŸ’¾ ì´ë¯¸ì§€ ì €ì¥</button>
                </div>
                
                <div class="button-group">
                    <button class="secondary" onclick="generateNewImage()">ğŸ–¼ï¸ ëœë¤ ì´ë¯¸ì§€</button>
                    <button class="secondary" onclick="generateNewQuote()">ğŸ’¬ ëœë¤ ëª…ì–¸</button>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-section">
                    <h3 class="section-title">ğŸ¨ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼</h3>
                    
                    <div class="control-group">
                        <label for="fontFamily">í°íŠ¸</label>
                        <select id="fontFamily">
                            <!-- í°íŠ¸ ì˜µì…˜ì€ fonts.jsì—ì„œ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="fontSize">ê¸€ì í¬ê¸°: <span id="fontSizeValue">60</span>px</label>
                        <input type="range" id="fontSize" min="30" max="100" value="60">
                    </div>
                    
                    <div class="control-group">
                        <label for="textColor">ê¸€ì ìƒ‰ìƒ</label>
                        <input type="color" id="textColor" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label for="bgOpacity">ë°°ê²½ ì–´ë‘¡ê¸°: <span id="bgOpacityValue">0.8</span></label>
                        <input type="range" id="bgOpacity" min="0" max="1" step="0.1" value="0.8">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3 class="section-title">ğŸ“ ëª…ì–¸ ì„¤ì •</h3>
                    
                    <div class="control-group">
                        <label for="quoteSelect">ëª…ì–¸ ì¹´í…Œê³ ë¦¬</label>
                        <select id="quoteSelect">
                            <option value="good">ì¢‹ì€ ê¸€ê·€</option>
                            <option value="custom">ì§ì ‘ ì…ë ¥</option>
                        </select>
                    </div>
                    
                    <div class="control-group" id="customQuoteGroup" style="display: none;">
                        <label for="customQuote">ëª…ì–¸ ì…ë ¥</label>
                        <textarea id="customQuote" placeholder="ë‹¹ì‹ ì˜ ëª…ì–¸ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3 class="section-title">ğŸ·ï¸ ë¡œê³  ì„¤ì •</h3>
                    
                    <div class="control-group">
                        <label class="checkbox-label" for="showLogo">
                            <input type="checkbox" id="showLogo" checked>
                            <span>ë¡œê³  í‘œì‹œ</span>
                        </label>
                    </div>
                    
                    <div class="control-group" id="logoSizeGroup">
                        <label for="logoSize">ë¡œê³  í¬ê¸°: <span id="logoSizeValue">120</span>px</label>
                        <input type="range" id="logoSize" min="40" max="200" value="120">
                    </div>
                    
                    <div class="control-group" id="logoPositionGroup">
                        <label for="logoPosition">ë¡œê³  ìœ„ì¹˜</label>
                        <select id="logoPosition">
                            <option value="bottom">í•˜ë‹¨</option>
                            <option value="top">ìƒë‹¨</option>
                        </select>
                    </div>
                    
                    <div class="control-group" id="logoMarginGroup">
                        <label for="logoMargin">ë¡œê³  ì—¬ë°±: <span id="logoMarginValue">100</span>px</label>
                        <input type="range" id="logoMargin" min="20" max="300" value="100">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ëª…ì–¸ ë°ì´í„°ë¥¼ ì €ì¥í•  ê°ì²´
        let quotesData = {
            good: []
        };

        // ì„ì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” ê° JSON íŒŒì¼ì—ì„œ ë¡œë“œ)
        const tempData = {
            good: [
                { "text": "ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ê°€ë©´ ì–¸ì  ê°€ëŠ” ë„ì°©í•œë‹¤." },
                { "text": "í˜ë“  ê¸¸ì¼ìˆ˜ë¡ ë„ì°©í–ˆì„ ë•Œì˜ ê¸°ì¨ì´ í¬ë‹¤." },
                { "text": "í¬ê¸°í•˜ì§€ ì•ŠëŠ” í•œ ì‹¤íŒ¨ëŠ” ì—†ë‹¤." },
                { "text": "ì–´ì œì™€ ë‹¤ë¥¸ ì˜¤ëŠ˜ì„ ë§Œë“¤ì–´ê°€ì." },
                { "text": "ì‘ì€ ë³€í™”ê°€ í° ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤." },
                { "text": "ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ì¼ì„ ë‚´ì¼ë¡œ ë¯¸ë£¨ì§€ ë§ˆë¼." },
                { "text": "ì‹œì‘ì´ ë°˜ì´ë‹¤." },
                { "text": "ê¾¸ì¤€í•¨ì´ ì¬ëŠ¥ì„ ì´ê¸´ë‹¤." },
                { "text": "ì‹¤íŒ¨ëŠ” ì„±ê³µìœ¼ë¡œ ê°€ëŠ” ê³¼ì •ì¼ ë¿ì´ë‹¤." },
                { "text": "ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤." }
            ]
        };

        // ëª…ì–¸ íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
        async function loadQuotes() {
            try {
                // ì‹¤ì œ JSON íŒŒì¼ ë¡œë“œ
                const response = await fetch('quotes/good.json');
                if (!response.ok) {
                    throw new Error('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                const goodQuotes = await response.json();
                
                quotesData = {
                    good: goodQuotes
                };
                
                console.log('ëª…ì–¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', quotesData);
                
            } catch (error) {
                console.error('ëª…ì–¸ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ë¡œë“œ ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
                quotesData = tempData;
                console.log('ì„ì‹œ ë°ì´í„° ì‚¬ìš©');
            }
        }

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let currentImageUrl = '';
        let currentImage = null;  // í˜„ì¬ ì´ë¯¸ì§€ ì €ì¥
        let currentQuote = null;
        let logoImage = null;  // ë¡œê³  ì´ë¯¸ì§€

        // ì»¨íŠ¸ë¡¤ ìš”ì†Œë“¤
        const quoteSelect = document.getElementById('quoteSelect');
        const customQuoteGroup = document.getElementById('customQuoteGroup');
        const customQuote = document.getElementById('customQuote');
        const fontFamily = document.getElementById('fontFamily');
        const fontSize = document.getElementById('fontSize');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const textColor = document.getElementById('textColor');
        const bgOpacity = document.getElementById('bgOpacity');
        const bgOpacityValue = document.getElementById('bgOpacityValue');
        const showLogo = document.getElementById('showLogo');
        const logoSize = document.getElementById('logoSize');
        const logoSizeValue = document.getElementById('logoSizeValue');
        const logoSizeGroup = document.getElementById('logoSizeGroup');
        const logoPosition = document.getElementById('logoPosition');
        const logoPositionGroup = document.getElementById('logoPositionGroup');
        const logoMargin = document.getElementById('logoMargin');
        const logoMarginValue = document.getElementById('logoMarginValue');
        const logoMarginGroup = document.getElementById('logoMarginGroup');
        const loading = document.getElementById('loading');

        // ë¡œê³  ì´ë¯¸ì§€ ë¡œë“œ
        async function loadLogo() {
            return new Promise((resolve, reject) => {
                const logo = new Image();
                logo.crossOrigin = 'anonymous';
                logo.onload = () => resolve(logo);
                logo.onerror = () => {
                    console.error('ë¡œê³  ë¡œë“œ ì‹¤íŒ¨');
                    resolve(null);  // ë¡œê³  ë¡œë“œ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
                };
                logo.src = '/gofit_logo/LOGO.png';
            });
        }

        // ë²„íŠ¼ ë¹„í™œì„±í™”/í™œì„±í™”
        function setButtonsDisabled(disabled) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = disabled);
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            loading.style.display = 'flex';
            setTimeout(() => loading.classList.add('active'), 10);
            setButtonsDisabled(true);
        }

        // ë¡œë”© ìˆ¨ê¸°ê¸°
        function hideLoading() {
            loading.classList.remove('active');
            setTimeout(() => loading.style.display = 'none', 300);
            setButtonsDisabled(false);
        }

        // ëœë¤ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
        async function getRandomImage() {
            showLoading();
            const randomId = Date.now() + '_' + Math.floor(Math.random() * 10000);
            currentImageUrl = `https://picsum.photos/1000/1000?random=${randomId}`;
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            return new Promise((resolve, reject) => {
                img.onload = () => {
                    hideLoading();
                    resolve(img);
                };
                img.onerror = () => {
                    hideLoading();
                    reject();
                };
                img.src = currentImageUrl;
            });
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        quoteSelect.addEventListener('change', (e) => {
            const value = e.target.value;
            customQuoteGroup.style.display = value === 'custom' ? 'block' : 'none';
            
            // ì¹´í…Œê³ ë¦¬ ë³€ê²½ì‹œ ìƒˆë¡œìš´ ëª…ì–¸ ì„ íƒ (custom ì œì™¸)
            if (value !== 'custom') {
                selectNewQuote(true);  // ê°•ì œë¡œ ìƒˆ ëª…ì–¸ ì„ íƒ
            } else {
                currentQuote = '';  // custom ì„ íƒì‹œ ì´ˆê¸°í™”
            }
            drawCanvas(false);  // ì´ë¯¸ì§€ëŠ” ìœ ì§€
        });

        fontSize.addEventListener('input', (e) => {
            fontSizeValue.textContent = e.target.value;
            drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
        });

        bgOpacity.addEventListener('input', (e) => {
            bgOpacityValue.textContent = e.target.value;
            drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
        });

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        customQuote.addEventListener('input', () => {
            if (quoteSelect.value === 'custom') {
                currentQuote = customQuote.value;
                drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
            }
        });
        
        fontFamily.addEventListener('change', () => drawCanvas(false));  // ì´ë¯¸ì§€ ìœ ì§€
        textColor.addEventListener('input', () => drawCanvas(false));  // ì´ë¯¸ì§€ ìœ ì§€

        showLogo.addEventListener('change', () => {
            logoSizeGroup.style.display = showLogo.checked ? 'block' : 'none';
            logoPositionGroup.style.display = showLogo.checked ? 'block' : 'none';
            logoMarginGroup.style.display = showLogo.checked ? 'block' : 'none';
            drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
        });

        logoSize.addEventListener('input', (e) => {
            logoSizeValue.textContent = e.target.value;
            drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
        });

        logoPosition.addEventListener('change', () => drawCanvas(false));  // ì´ë¯¸ì§€ ìœ ì§€
        
        logoMargin.addEventListener('input', (e) => {
            logoMarginValue.textContent = e.target.value;
            drawCanvas(false);  // ì´ë¯¸ì§€ ìœ ì§€
        });

        // ìƒˆë¡œìš´ ëª…ì–¸ ì„ íƒ
        function selectNewQuote(forceNew = false) {
            const category = quoteSelect.value;
            
            if (category === 'custom') {
                currentQuote = customQuote.value || 'ë‹¹ì‹ ì˜ ëª…ì–¸ì„ ì…ë ¥í•˜ì„¸ìš”';
            } else {
                // forceNewê°€ trueì´ê±°ë‚˜ í˜„ì¬ ëª…ì–¸ì´ ì—†ì„ ë•Œë§Œ ìƒˆë¡œìš´ ëª…ì–¸ ì„ íƒ
                if (forceNew || !currentQuote) {
                    const quotes = quotesData.good || [];
                    if (quotes.length > 0) {
                        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                        currentQuote = randomQuote.text || 'ëª…ì–¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                    } else {
                        currentQuote = 'ëª…ì–¸ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...';
                    }
                }
            }
        }

        // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
        async function drawCanvas(newImage = false) {
            if (newImage || !currentImage) {
                try {
                    currentImage = await getRandomImage();
                } catch (error) {
                    console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                    return;
                }
            }

            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(currentImage, 0, 0, 1000, 1000);

            // ë°˜íˆ¬ëª… ì˜¤ë²„ë ˆì´
            ctx.fillStyle = `rgba(0, 0, 0, ${bgOpacity.value})`;
            ctx.fillRect(0, 0, 1000, 1000);

            // í…ìŠ¤íŠ¸ ì„¤ì •
            ctx.fillStyle = textColor.value;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // í˜„ì¬ ì„ íƒëœ ëª…ì–¸ ì‚¬ìš©
            const quote = currentQuote || 'ëª…ì–¸ì„ ì„ íƒí•˜ì„¸ìš”';

            // í°íŠ¸ ì„¤ì • (í´ë°± ì¶”ê°€)
            const fontValue = fontFamily.value || "'Noto Sans KR', sans-serif";
            
            // ëª…ì–¸ ê·¸ë¦¬ê¸°
            ctx.font = `${fontSize.value}px ${fontValue}`;
            
            // í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
            const maxWidth = 800;
            const lineHeight = parseInt(fontSize.value) * 1.5;
            const words = quote.split(' ');
            const lines = [];
            let currentLine = '';

            for (let word of words) {
                const testLine = currentLine + word + ' ';
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && currentLine !== '') {
                    lines.push(currentLine);
                    currentLine = word + ' ';
                } else {
                    currentLine = testLine;
                }
            }
            lines.push(currentLine);

            // í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬
            const totalHeight = lines.length * lineHeight;
            const startY = 500 - totalHeight / 2;

            lines.forEach((line, index) => {
                ctx.fillText(line.trim(), 500, startY + index * lineHeight);
            });

            // ë¡œê³  ê·¸ë¦¬ê¸°
            if (logoImage && showLogo.checked) {
                const logoHeight = parseInt(logoSize.value);  // ë™ì  ë¡œê³  ë†’ì´
                const logoRatio = logoImage.width / logoImage.height;
                const logoWidth = logoHeight * logoRatio;
                const margin = parseInt(logoMargin.value);  // ë™ì  ì—¬ë°±
                
                // ë¡œê³  ìœ„ì¹˜ (ì¤‘ì•™ ì •ë ¬)
                const logoX = (1000 - logoWidth) / 2;
                let logoY;
                
                if (logoPosition.value === 'top') {
                    logoY = margin;  // ìƒë‹¨ì—ì„œ ë™ì  ì—¬ë°±
                } else {
                    logoY = 1000 - logoHeight - margin;  // í•˜ë‹¨ì—ì„œ ë™ì  ì—¬ë°±
                }
                
                // ë¡œê³  ê·¸ë¦¬ê¸°
                ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);
            }
        }

        // ëœë¤ ì¡°í•© (ì´ë¯¸ì§€ + ëª…ì–¸ ëª¨ë‘ ë³€ê²½)
        async function generateNewCombination() {
            // ìƒˆë¡œìš´ ëª…ì–¸ ê°•ì œ ì„ íƒ (customì´ ì•„ë‹Œ ê²½ìš°ë§Œ)
            if (quoteSelect.value !== 'custom') {
                selectNewQuote(true);
            }
            // ìƒˆë¡œìš´ ì´ë¯¸ì§€ ë¡œë“œ
            await drawCanvas(true);
        }

        // ëœë¤ ì´ë¯¸ì§€ë§Œ ë³€ê²½
        async function generateNewImage() {
            await drawCanvas(true);
        }

        // ëœë¤ ëª…ì–¸ë§Œ ë³€ê²½
        function generateNewQuote() {
            if (quoteSelect.value !== 'custom') {
                selectNewQuote(true);
                drawCanvas(false);  // ì´ë¯¸ì§€ëŠ” ìœ ì§€
            }
        }

        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        function downloadImage() {
            const link = document.createElement('a');
            const date = new Date();
            const fileName = `quote_${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2,'0')}${date.getDate().toString().padStart(2,'0')}_${date.getHours().toString().padStart(2,'0')}${date.getMinutes().toString().padStart(2,'0')}${date.getSeconds().toString().padStart(2,'0')}.png`;
            
            link.download = fileName;
            link.href = canvas.toDataURL();
            link.click();
        }

        // ì´ˆê¸°í™”
        async function init() {
            // ì´ˆê¸° ë¡œë”© í‘œì‹œ
            showLoading();
            
            try {
                // ë¡œê³  ë¡œë“œ
                logoImage = await loadLogo();
                
                // ëª…ì–¸ ë°ì´í„° ë¡œë“œ
                await loadQuotes();
                
                // í°íŠ¸ê°€ ì™„ì „íˆ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                await document.fonts.ready;
                
                // í°íŠ¸ selectê°€ ì±„ì›Œì§ˆ ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // ê¸°ë³¸ í°íŠ¸ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!fontFamily.value) {
                    fontFamily.value = "'Nanum Myeongjo', serif";
                }
                
                // ëª…ì–¸ ì„ íƒ
                selectNewQuote(true);
                
                // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
                await drawCanvas(true);
                
                // ë¡œê³  ê´€ë ¨ ì»¨íŠ¸ë¡¤ ì´ˆê¸° ìƒíƒœ
                logoSizeGroup.style.display = showLogo.checked ? 'block' : 'none';
                logoPositionGroup.style.display = showLogo.checked ? 'block' : 'none';
                logoMarginGroup.style.display = showLogo.checked ? 'block' : 'none';
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                hideLoading();
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            // DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš°
            init();
        }
    </script>
</body>
</html>