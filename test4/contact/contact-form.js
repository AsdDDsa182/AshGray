/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                        GLOBAL VARIABLES                                   ‚ñà‚ñà
‚ñà‚ñà                           Ï†ÑÏó≠ Î≥ÄÏàò ÏÑ§Ï†ï                                    ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ï†úÌíà Îç∞Ïù¥ÌÑ∞ (products-data.jsÏóêÏÑú Í∞ÄÏ†∏Ïò¥)
let products = [];

// ÌòÑÏû¨ ÌôúÏÑ± ÌÉ≠
let activeTab = 'general';
let currentFormType = '';
let selectedProducts = {
  purchase: [],
  rental: []
};

// Î™®Îã¨ÏóêÏÑú ÏûÑÏãúÎ°ú ÏÑ†ÌÉùÌïú Ï†úÌíàÎì§
let tempSelectedProducts = [];

// Ïä§ÌÅ¨Î°§ ÌÉÄÏù¥Î®∏ Î≥ÄÏàò
let scrollTimer = null;

// üî• ÏÑ±Îä• ÏµúÏ†ÅÌôîÎ•º ÏúÑÌïú Î≥ÄÏàò
let isModalOpening = false; // Î™®Îã¨ Ïó¥Í∏∞ Ï§ëÎ≥µ Î∞©ÏßÄ
let renderingBatch = null; // Î∞∞Ïπò Î†åÎçîÎßÅÏö©
let visibleProductsCount = 8; // Ï≤òÏùåÏóê Î≥¥Ïó¨Ï§Ñ Ï†úÌíà Ïàò
let allFilteredProducts = []; // ÌïÑÌÑ∞ÎßÅÎêú Ï†ÑÏ≤¥ Ï†úÌíà
let isLoadingMore = false; // Ï∂îÍ∞Ä Î°úÎî© Ï§ë ÌîåÎûòÍ∑∏

// üÜï Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î°úÎçî Ï∫êÏãú
const imageCache = new Map();

// üî• Î†åÌÉà Í∏∞Í∞ÑÎ≥Ñ Í≥ÑÏÇ∞ÏùÑ ÏúÑÌïú Î≥ÄÏàò (ÏÉàÎ°ú Ï∂îÍ∞Ä)
let selectedRentalPeriod = 12; // Í∏∞Î≥∏Í∞í: 12Í∞úÏõî

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    RENTAL CALCULATION SYSTEM                              ‚ñà‚ñà
‚ñà‚ñà                    Î†åÌÉà Í∏∞Í∞ÑÎ≥Ñ Í∞ÄÍ≤© Í≥ÑÏÇ∞ ÏãúÏä§ÌÖú (ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ)                   ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Î†åÌÉà ÏöîÏú®Ìëú (Í∏∞Ï°¥ Ïú†ÏßÄ)
const rentalRates = {
  12: 0.09947,  // D1 - 9.9% Ï∂îÍ∞Ä
  24: 0.05262,  // F1 - 5.3% Ï∂îÍ∞Ä
  36: 0.03691,  // H1 - 3.7% Ï∂îÍ∞Ä
  48: 0.02964,  // J1 - 3.0% Ï∂îÍ∞Ä
  60: 0.02539   // L1 - 2.5% Ï∂îÍ∞Ä
};

// üî• Î†åÌÉà Í∞ÄÍ≤© Í≥ÑÏÇ∞ Ìï®Ïàò (ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ - Í∏∞Î≥∏Í∞ÄÏóê ÏöîÏú®ÏùÑ Ï∂îÍ∞Ä)
function calculateRentalPrice(originalPrice, months) {
  if (!rentalRates[months]) {
    console.warn(`ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Î†åÌÉà Í∏∞Í∞Ñ: ${months}Í∞úÏõî`);
    return originalPrice; // Í∏∞Î≥∏Í∞í Î∞òÌôò
  }
  
  const rate = rentalRates[months];
  
  // üî• ÏàòÏ†ïÎêú Í≥ÑÏÇ∞ Î∞©Ïãù: Í∏∞Î≥∏Í∞Ä + (Í∏∞Î≥∏Í∞Ä √ó ÏöîÏú®)
  // originalPrice √ó (1 + rate) = Í∏∞Î≥∏Í∞ÄÏóê ÏöîÏú®ÏùÑ Ï∂îÍ∞Ä
  const base = originalPrice * (1 + rate);
  
  // 1000Ïõê Îã®ÏúÑÎ°ú Ïò¨Î¶º Ï≤òÎ¶¨
  const rounded = Math.ceil(base / 1000) * 1000;
  
  // 10% Î∂ÄÍ∞ÄÏÑ∏ Ï∂îÍ∞Ä
  const monthlyRental = Math.round(rounded * 1.1);
  
  return monthlyRental;
}

// üî• ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Î†åÌÉà Í∏∞Í∞Ñ Í∞ÄÏ†∏Ïò§Í∏∞
function getCurrentRentalPeriod() {
  const rentalForm = document.getElementById('rental-form');
  if (!rentalForm) return 12; // Í∏∞Î≥∏Í∞í
  
  const periodSelect = rentalForm.querySelector('select[name="rental-period"]');
  if (!periodSelect || !periodSelect.value) return 12; // Í∏∞Î≥∏Í∞í
  
  return parseInt(periodSelect.value);
}

// üî• Î™®Îì† Î†åÌÉà Ï†úÌíàÏùò Í∞ÄÍ≤©ÏùÑ ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞ÑÏóê ÎßûÍ≤å ÏóÖÎç∞Ïù¥Ìä∏
function updateAllRentalPrices() {
  selectedRentalPeriod = getCurrentRentalPeriod();
  
  // ÏÑ†ÌÉùÎêú Ï†úÌíàÎì§Ïùò Î†åÌÉà Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
  selectedProducts.rental.forEach(product => {
    // ÏõêÎûò rentalPriceÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏÉàÎ°úÏö¥ Í∞ÄÍ≤© Í≥ÑÏÇ∞
    const originalPrice = product.originalRentalPrice || product.rentalPrice;
    if (!product.originalRentalPrice) {
      product.originalRentalPrice = product.rentalPrice; // ÏµúÏ¥à 1ÌöåÎßå Ï†ÄÏû•
    }
    product.rentalPrice = calculateRentalPrice(originalPrice, selectedRentalPeriod);
  });
  
  // ÏûÑÏãú ÏÑ†ÌÉùÎêú Ï†úÌíàÎì§Ïùò Í∞ÄÍ≤©ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
  tempSelectedProducts.forEach(product => {
    const originalPrice = product.originalRentalPrice || product.rentalPrice;
    if (!product.originalRentalPrice) {
      product.originalRentalPrice = product.rentalPrice;
    }
    product.rentalPrice = calculateRentalPrice(originalPrice, selectedRentalPeriod);
  });
  
  // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
  if (currentFormType === 'rental') {
    renderSelectedProducts();
    updateRentalBudgetComparison();
    
    // Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÎã§Î©¥ Ï†úÌíà Í∞ÄÍ≤©ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
    const modal = document.getElementById('productModal');
    if (modal && modal.classList.contains('show')) {
      renderProductsOptimized(window.currentCategory || 'all');
    }
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    RENTAL CALCULATION SYSTEM ÎÅù                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FORM VALIDATION VARIABLES                              ‚ñà‚ñà
‚ñà‚ñà                    Ìèº Í≤ÄÏ¶ùÏö© Ï†ÑÏó≠ Î≥ÄÏàò (ÏÉàÎ°ú Ï∂îÍ∞Ä)                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// ÌéòÏù¥ÏßÄ Ï†ëÏÜç ÏãúÍ∞Ñ Í∏∞Î°ù (Ïä§Ìå∏ Î∞©ÏßÄÏö©)
let pageLoadTime = Date.now();

// Ìèº Í≤ÄÏ¶ù ÏÉÅÌÉú Ï†ÄÏû•
formValidationStates = {
  general: {
    name: false,
    email: false,
    phone: false, // üî• ÏùºÎ∞òÎ¨∏ÏùòÎèÑ Ï†ÑÌôîÎ≤àÌò∏ ÌïÑÏàòÎ°ú Î≥ÄÍ≤Ω
    company: true, // ÌöåÏÇ¨Î™ÖÏùÄ ÏÑ†ÌÉùÏÇ¨Ìï≠
    inquiryType: false,
    message: false,
    privacyAgree: false
  },
  purchase: {
    name: false,
    email: false,
    phone: false,
    company: true, // ÌöåÏÇ¨Î™ÖÏùÄ ÏÑ†ÌÉùÏÇ¨Ìï≠
    products: false, // Ï†úÌíà ÏÑ†ÌÉù ÌïÑÏàò
    privacyAgree: false
  },
  rental: {
    name: false,
    email: false,
    phone: false,
    rentalPeriod: false, // Î†åÌÉà Í∏∞Í∞Ñ ÌïÑÏàò
    products: false, // üî• Î†åÌÉàÎèÑ Ï†úÌíà ÏÑ†ÌÉù ÌïÑÏàòÎ°ú Ï∂îÍ∞Ä
    privacyAgree: false
  }
};


/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FORM VALIDATION VARIABLES ÎÅù                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                          DATA MANAGEMENT                                  ‚ñà‚ñà
‚ñà‚ñà                            Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨                                      ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÌôïÏù∏ Î∞è Ï¥àÍ∏∞Ìôî
function loadContactProducts() {
  if (typeof GOFIT_PRODUCTS === 'undefined') {
    console.error('‚ùå products-data.js ÌååÏùºÏù¥ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§!');
    return;
  }
  
  products = GOFIT_PRODUCTS;

}

// üÜï Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î°úÎìú Ìï®Ïàò
function preloadImage(url) {
  if (imageCache.has(url)) {
    return imageCache.get(url);
  }
  
  const img = new Image();
  img.src = url;
  imageCache.set(url, img);
  return img;
}

// üÜï Ï§ëÏöîÌïú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨ Î°úÎìú
function preloadImportantImages() {
  // Ï≤òÏùå 8Í∞ú Ï†úÌíàÏùò Ïù¥ÎØ∏ÏßÄÎßå ÎØ∏Î¶¨ Î°úÎìú
  products.slice(0, 8).forEach(product => {
    const thumbnailUrl = product.images && product.images.length > 0
      ? (product.images[0].includes('?w=') 
        ? product.images[0].replace(/\?w=\d+/, '?w=150') 
        : product.images[0] + '?w=150')
      : '/products/images/placeholder.jpg';
    preloadImage(thumbnailUrl);
  });
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                        SCROLL ANIMATIONS                                  ‚ñà‚ñà
‚ñà‚ñà                           Ïä§ÌÅ¨Î°§ Ïï†ÎãàÎ©îÏù¥ÏÖò                                 ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ïä§ÌÅ¨Î°§ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÑ§Ï†ï
function setupContactScrollAnimations() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  const elementsToObserve = [
    '.gf-contact-page-header',
    '.gfnew-form-section'
  ];
  
  elementsToObserve.forEach(selector => {
    const element = document.querySelector(selector);
    if (element) {
      observer.observe(element);
    }
  });
  
  observeActiveFormElements(observer);
}

// ÌôúÏÑ± ÌèºÏùò ÏöîÏÜåÎì§ Í¥ÄÏ∞∞
function observeActiveFormElements(observer) {
  const activeForm = document.querySelector('.gfnew-form-panel.active');
  if (!activeForm) return;
  
  const animateElements = activeForm.querySelectorAll('.gf-form-animate');
  animateElements.forEach(element => {
    observer.observe(element);
  });
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                          TAB MANAGEMENT                                   ‚ñà‚ñà
‚ñà‚ñà                            ÌÉ≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú                                   ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// ÌÉ≠ Ï†ÑÌôò
function showTab(tabName, event) {
  activeTab = tabName;
  
  document.querySelectorAll('.gfnew-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  event.target.classList.add('active');
  
  document.querySelectorAll('.gfnew-form-panel').forEach(panel => {
    panel.style.display = 'none';
    panel.classList.remove('active');
  });
  const activePanel = document.getElementById(`${tabName}-form`);
  activePanel.style.display = 'block';
  activePanel.classList.add('active');
  
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  const animateElements = activePanel.querySelectorAll('.gf-form-animate');
  animateElements.forEach(element => {
    element.classList.remove('visible');
    setTimeout(() => {
      observer.observe(element);
    }, 100);
  });
  
  // üî• ÌÉ≠ Ï†ÑÌôò Ïãú ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú ÏóÖÎç∞Ïù¥Ìä∏ + Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ Ï≤òÎ¶¨ (ÌÜµÌï©)
  if (tabName === 'purchase' && selectedProducts.purchase.length > 0) {
    // Íµ¨Îß§ Í≤¨Ï†ÅÏÑú ÌÉ≠ÏúºÎ°ú Ï†ÑÌôòÌïòÍ≥† Ï†úÌíàÏù¥ ÏûàÏúºÎ©¥ ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú ÌëúÏãú
    currentFormType = 'purchase';
    renderSelectedProducts();
    updateBudgetComparison();
  } else if (tabName === 'rental') {
    // Î†åÌÉà Í≤¨Ï†ÅÏÑú ÌÉ≠ÏúºÎ°ú Ï†ÑÌôò (Ï†úÌíà Í∞úÏàòÏôÄ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï≤òÎ¶¨)
    currentFormType = 'rental';
    
    // üî• Î†åÌÉà Í∏∞Í∞ÑÏóê Îî∞Î•∏ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
    updateAllRentalPrices();
    
    if (selectedProducts.rental.length > 0) {
      // Ï†úÌíàÏù¥ ÏûàÏúºÎ©¥ ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú ÌëúÏãú
      renderSelectedProducts();
      updateRentalBudgetComparison();
    }
    
    // üî• Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ ÏóÖÎç∞Ïù¥Ìä∏ (Ï†úÌíà Í∞úÏàòÏôÄ Í¥ÄÍ≥ÑÏóÜÏù¥ Ìï≠ÏÉÅ ÌôïÏù∏)
    const totalQuantity = selectedProducts.rental.reduce((total, product) => {
      return total + product.quantity;
    }, 0);
    updateRentalGuideMessage(totalQuantity, totalQuantity >= 5);
  } else {
    // üî• Î†åÌÉà ÌÉ≠Ïù¥ ÏïÑÎãàÎ©¥ ÏïàÎÇ¥ Î¨∏Íµ¨ Ïà®ÍπÄ
    const guideElement = document.getElementById('rental-guide');
    if (guideElement) {
      guideElement.classList.remove('show');
    }
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      FILTER DRAG SCROLL SYSTEM                            ‚ñà‚ñà
‚ñà‚ñà                       ÌïÑÌÑ∞ ÎìúÎûòÍ∑∏ Ïä§ÌÅ¨Î°§ ÏãúÏä§ÌÖú                               ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/**
 * üî• Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉ≠ ÎßàÏö∞Ïä§ ÎìúÎûòÍ∑∏ Í∏∞Îä• Ï¥àÍ∏∞Ìôî üî•
 * Products ÌéòÏù¥ÏßÄÏôÄ ÎèôÏùºÌïú Î∞©ÏãùÏúºÎ°ú Íµ¨ÌòÑ
 */
function initFilterCategoryDrag() {
  const categoriesContainer = document.querySelector('.gfnew-filter-wrapper');
  if (!categoriesContainer) return;
  
  let isDown = false;
  let startX;
  let scrollLeft;
  let startTime;
  let dragDistance = 0;
  
  // üî• ÎìúÎûòÍ∑∏ Ï§ëÏóêÎäî smooth Ïä§ÌÅ¨Î°§ ÎπÑÌôúÏÑ±Ìôî üî•
  const disableSmoothScroll = () => {
    categoriesContainer.style.scrollBehavior = 'auto';
  };
  
  const enableSmoothScroll = () => {
    // ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å ÌõÑ Ïû†Ïãú Îí§Ïóê smooth Ïä§ÌÅ¨Î°§ Î≥µÏõê
    setTimeout(() => {
      categoriesContainer.style.scrollBehavior = 'smooth';
    }, 100);
  };
  
  // ÎßàÏö∞Ïä§ Îã§Ïö¥ Ïù¥Î≤§Ìä∏ (Î≤ÑÌäº ÏúÑÏóêÏÑúÎèÑ ÏûëÎèô)
  categoriesContainer.addEventListener('mousedown', (e) => {
    // Î™®Î∞îÏùºÏóêÏÑúÎßå ÎìúÎûòÍ∑∏ ÌôúÏÑ±Ìôî
    if (window.innerWidth > 768) return;
    
    isDown = true;
    startTime = Date.now();
    dragDistance = 0;
    
    categoriesContainer.classList.add('active');
    startX = e.pageX;
    scrollLeft = categoriesContainer.scrollLeft;
    categoriesContainer.style.cursor = 'grabbing';
    
    // üî• ÎìúÎûòÍ∑∏ ÏãúÏûë Ïãú smooth Ïä§ÌÅ¨Î°§ ÎπÑÌôúÏÑ±Ìôî üî•
    disableSmoothScroll();
    
    // ÌÖçÏä§Ìä∏ ÏÑ†ÌÉù Î∞©ÏßÄ
    e.preventDefault();
  });
  
  // ÎßàÏö∞Ïä§ Îñ†ÎÇ® Ïù¥Î≤§Ìä∏
  categoriesContainer.addEventListener('mouseleave', () => {
    if (!isDown) return;
    
    // ÎìúÎûòÍ∑∏ Í±∞Î¶¨Í∞Ä Ï∂©Î∂ÑÌïòÎ©¥ Î≤ÑÌäºÎì§Ïóê ÎìúÎûòÍ∑∏ ÌëúÏãú
    if (Math.abs(dragDistance) > 5) {
      const buttons = categoriesContainer.querySelectorAll('.gfnew-filter-tab');
      buttons.forEach(btn => {
        btn.dataset.dragging = 'true';
      });
    }
    
    isDown = false;
    categoriesContainer.classList.remove('active');
    categoriesContainer.style.cursor = 'grab';
    enableSmoothScroll();
  });
  
  // ÎßàÏö∞Ïä§ ÏóÖ Ïù¥Î≤§Ìä∏
  categoriesContainer.addEventListener('mouseup', (e) => {
    if (!isDown) return;
    
    const endTime = Date.now();
    const timeDiff = endTime - startTime;
    
    // üî• ÎìúÎûòÍ∑∏ Í±∞Î¶¨ÏôÄ ÏãúÍ∞ÑÏúºÎ°ú ÌÅ¥Î¶≠/ÎìúÎûòÍ∑∏ Íµ¨Î∂Ñ üî•
    if (Math.abs(dragDistance) > 5 || timeDiff > 200) {
      // ÎìúÎûòÍ∑∏Î°ú ÌåêÎã® - Î™®Îì† Î≤ÑÌäºÏóê ÌëúÏãú
      const buttons = categoriesContainer.querySelectorAll('.gfnew-filter-tab');
      buttons.forEach(btn => {
        btn.dataset.dragging = 'true';
      });
      
      // ÏßßÏùÄ ÏãúÍ∞Ñ ÌõÑ ÎìúÎûòÍ∑∏ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
      setTimeout(() => {
        buttons.forEach(btn => {
          btn.dataset.dragging = 'false';
        });
      }, 50);
    }
    
    isDown = false;
    categoriesContainer.classList.remove('active');
    categoriesContainer.style.cursor = 'grab';
    
    // üî• ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å Ïãú smooth Ïä§ÌÅ¨Î°§ Î≥µÏõê üî•
    enableSmoothScroll();
  });
  
  // ÎßàÏö∞Ïä§ Î¨¥Î∏å Ïù¥Î≤§Ìä∏
  categoriesContainer.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    
    const x = e.pageX;
    const distance = x - startX;
    dragDistance = distance;
    
    // üî• Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ïä§ÌÅ¨Î°§ ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ üî•
    categoriesContainer.scrollLeft = scrollLeft - distance;
  });
  
  // üî• ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ (Î™®Î∞îÏùºÍ≥º Ï∂©Îèå Î∞©ÏßÄ) üî•
  categoriesContainer.addEventListener('touchstart', (e) => {
    isDown = false;
  });
  
  // üî• ÌôîÎ©¥ ÌÅ¨Í∏∞Ïóê Îî∞Îùº Ïª§ÏÑú Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω üî•
  function updateCursorStyle() {
    if (window.innerWidth <= 768) {
      categoriesContainer.style.cursor = 'grab';
    } else {
      categoriesContainer.style.cursor = 'default';
    }
  }
  
  // Ï¥àÍ∏∞ Ïª§ÏÑú Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
  updateCursorStyle();
  
  // Î¶¨ÏÇ¨Ïù¥Ï¶à Ïãú Ïª§ÏÑú Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
  window.addEventListener('resize', updateCursorStyle);
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      FILTER DRAG SCROLL SYSTEM ÎÅù                         ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                       PRODUCT MODAL SYSTEM                                ‚ñà‚ñà
‚ñà‚ñà                         Ï†úÌíà ÏÑ†ÌÉù Î™®Îã¨ ÏãúÏä§ÌÖú                                ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ï†úÌíà Î™®Îã¨ Ïó¥Í∏∞ - Í∑ºÎ≥∏Ï†Å Î¨∏Ï†ú Ìï¥Í≤∞
function openProductModal(formType) {
  // Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ
  if (isModalOpening) return;
  isModalOpening = true;
  
  currentFormType = formType;
  window.currentCategory = 'all';
  

  
  // Î™®Îã¨ ÌëúÏãú (Î®ºÏ†Ä Î™®Îã¨ÏùÑ Î≥¥Ïó¨Ï£ºÍ≥†)
  const modal = document.getElementById('productModal');
  modal.classList.add('show');
  document.body.style.overflow = 'hidden';
  
  // ÏûÑÏãú ÏÑ†ÌÉù Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
  tempSelectedProducts = [...selectedProducts[currentFormType]];
  
  // üî• Î†åÌÉà Î™®Îã¨Ïù∏ Í≤ΩÏö∞ ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞ÑÏóê ÎßûÍ≤å Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
  if (formType === 'rental') {
    selectedRentalPeriod = getCurrentRentalPeriod();
    tempSelectedProducts.forEach(product => {
      const originalPrice = product.originalRentalPrice || product.rentalPrice;
      if (!product.originalRentalPrice) {
        product.originalRentalPrice = product.rentalPrice;
      }
      product.rentalPrice = calculateRentalPrice(originalPrice, selectedRentalPeriod);
    });
  }

// üî• ÌïÑÌÑ∞ ÌÉ≠ Ï¥àÍ∏∞Ìôî - Ï≤´ Î≤àÏß∏ ÌÉ≠(All) ÌôúÏÑ±Ìôî
setTimeout(() => {
  const filterTabs = document.querySelectorAll('.gfnew-filter-tab');
  
  filterTabs.forEach((tab, index) => {
    tab.classList.remove('active');
    
    // Ï≤´ Î≤àÏß∏ ÌÉ≠ÏùÑ AllÎ°ú Í∞ïÏ†ú ÌôúÏÑ±Ìôî
    if (index === 0) {
      tab.classList.add('active');
    }
  });
  
  // üî• ÌïÑÌÑ∞ ÎìúÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî
  initFilterCategoryDrag();
}, 100);
  
  // Ï¥àÍ∏∞ Ï†úÌíà Ïàò ÏÑ§Ï†ï
  visibleProductsCount = 8;
  
  // üÜï Î°úÎî© ÌëúÏãúÎ•º Î®ºÏ†Ä Î≥¥Ïó¨Ï£ºÍ∏∞
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '<div class="gfnew-loading"><div class="gfnew-loading-spinner"></div></div>';
  
  // üÜï Î™®Îã¨ Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ ÎÅùÎÇú ÌõÑ Ï†úÌíà Î†åÎçîÎßÅ (300ms ÎîúÎ†àÏù¥)
  setTimeout(() => {
    renderProductsOptimized('all');
    updateSelectionCount();
    
    // Ïä§ÌÅ¨Î°§ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
    const modalBody = document.querySelector('.gfnew-modal-body');
    
    modalBody.addEventListener('scroll', handleModalScroll);
    modalBody.addEventListener('scroll', handleInfiniteScroll);
    
    // Î™®Îã¨ Ïó¥Í∏∞ ÏôÑÎ£å
    isModalOpening = false;

  }, 300);
}

// Ï†úÌíà Î™®Îã¨ Îã´Í∏∞
function closeProductModal() {
  const modal = document.getElementById('productModal');
  modal.classList.remove('show');
  document.body.style.overflow = '';
  
  tempSelectedProducts = [];
  
  const modalBody = document.querySelector('.gfnew-modal-body');
  
  modalBody.removeEventListener('scroll', handleModalScroll);
  modalBody.removeEventListener('scroll', handleInfiniteScroll);
  
  modalBody.classList.remove('scrolling');
  
  clearTimeout(scrollTimer);
  
  // üÜï Î†åÎçîÎßÅ Ï∑®ÏÜå
  if (renderingBatch) {
    cancelAnimationFrame(renderingBatch);
  }
}

// Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
document.getElementById('productModal')?.addEventListener('click', function(e) {
  if (e.target === this) {
    closeProductModal();
  }
});

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                       PRODUCT RENDERING                                   ‚ñà‚ñà
‚ñà‚ñà                         Ï†úÌíà Î†åÎçîÎßÅ ÏãúÏä§ÌÖú                                   ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ï†úÌíà ÌïÑÌÑ∞ÎßÅ Ìï®Ïàò - Í∑ºÎ≥∏ Î¨∏Ï†ú Ìï¥Í≤∞ + Í∞ÑÎã®Ìïú Ï†úÌíà ÏóÜÏùå Î©îÏãúÏßÄ
function renderProductsOptimized(category) {

  
  const grid = document.getElementById('productGrid');
  
  // ÌïÑÌÑ∞ÎßÅÎêú Ï†úÌíà Ï†ÄÏû•
  if (category === 'all') {
    allFilteredProducts = products;

  } else if (category === 'promotion') {
    // üî• ÌîÑÎ°úÎ™®ÏÖò ÌïÑÌÑ∞ÎßÅ ÏàòÏ†ï - PROMOTION ÎåÄÎ¨∏ÏûêÎ°ú ÌôïÏù∏
    allFilteredProducts = products.filter(p => {
      if (!p.badge) return false;
      const badges = Array.isArray(p.badge) ? p.badge : [p.badge];
      return badges.some(badge => badge && badge.toUpperCase() === 'PROMOTION');
    });

  } else {
    // üî• ÏùºÎ∞ò Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ÎßÅ - products-data.jsÏùò ÏòÅÏñ¥ Ïπ¥ÌÖåÍ≥†Î¶¨ÏôÄ ÏùºÏπò
    allFilteredProducts = products.filter(p => p.category === category);

  }
  
  // üÜï Ï†úÌíàÏù¥ ÏóÜÏùÑ Îïå Í∞ÑÎã®Ìïú Î©îÏãúÏßÄ ÌëúÏãú
  if (allFilteredProducts.length === 0) {
    // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïúÍµ≠Ïñ¥ Ïù¥Î¶Ñ Îß§Ìïë
    const categoryNames = {
      'all': 'Ï†ÑÏ≤¥',
      'promotion': 'ÌîÑÎ°úÎ™®ÏÖò',
      'Weight': 'Ïõ®Ïù¥Ìä∏',
      'Free weights': 'ÌîÑÎ¶¨Ïõ®Ïù¥Ìä∏',
      'Cardio': 'Ïπ¥ÎîîÏò§'
    };
    
    const categoryDisplayName = categoryNames[category] || category;
    
    grid.innerHTML = `
      <div class="gfnew-no-products">
        <p>${categoryDisplayName} Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê Ï†úÌíàÏù¥ ÏóÜÏäµÎãàÎã§.</p>
        <p>Îã§Î•∏ Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌï¥ Î≥¥ÏÑ∏Ïöî.</p>
      </div>
    `;
    return;
  }
  
  // üÜï Î†åÎçîÎßÅÏùÑ Îã§Ïùå ÌîÑÎ†àÏûÑÏúºÎ°ú ÏòàÏïΩ
  if (renderingBatch) {
    cancelAnimationFrame(renderingBatch);
  }
  
  renderingBatch = requestAnimationFrame(() => {
    renderProductBatch(0);
  });
}

// üÜï Î∞∞ÏπòÎ°ú Ï†úÌíà Î†åÎçîÎßÅ (ÌïúÎ≤àÏóê 4Í∞úÏî©) - Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Î∞©ÏãùÏúºÎ°ú Î≥µÏõê
function renderProductBatch(startIndex) {
  const grid = document.getElementById('productGrid');
  const batchSize = 4; // ÌïúÎ≤àÏóê Î†åÎçîÎßÅÌï† Ï†úÌíà Ïàò
  const endIndex = Math.min(startIndex + batchSize, visibleProductsCount);
  const productsToShow = allFilteredProducts.slice(startIndex, endIndex);
  
  // Ï≤´ Î∞∞ÏπòÏù∏ Í≤ΩÏö∞ Í∑∏Î¶¨Îìú Ï¥àÍ∏∞Ìôî
  if (startIndex === 0) {
    grid.innerHTML = '';
  }
  
  const fragment = document.createDocumentFragment();
  
  productsToShow.forEach(product => {
    const productCard = createProductCard(product);
    fragment.appendChild(productCard);
  });
  
  grid.appendChild(fragment);
  
  // Îã§Ïùå Î∞∞ÏπòÍ∞Ä ÏûàÏúºÎ©¥ Í≥ÑÏÜç Î†åÎçîÎßÅ
  if (endIndex < visibleProductsCount && endIndex < allFilteredProducts.length) {
    requestAnimationFrame(() => {
      renderProductBatch(endIndex);
    });
  }
  // üî• ÎçîÎ≥¥Í∏∞ Î≤ÑÌäº Î°úÏßÅ ÏôÑÏ†Ñ Ï†úÍ±∞ - Î¨¥Ìïú Ïä§ÌÅ¨Î°§Îßå ÏÇ¨Ïö©
}

// üî• Îçî ÎßéÏùÄ Ï†úÌíà Î°úÎìú - Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Î∞©ÏãùÏúºÎ°ú ÏàòÏ†ï
function loadMoreProducts() {
  if (isLoadingMore) return;
  if (visibleProductsCount >= allFilteredProducts.length) return; // Îçî Ïù¥ÏÉÅ Î°úÎìúÌï† Ï†úÌíàÏù¥ ÏóÜÏúºÎ©¥ Ï¢ÖÎ£å
  
  isLoadingMore = true;
  
  const grid = document.getElementById('productGrid');
  
  // üÜï Î°úÎî© Ïä§ÌîºÎÑà ÌëúÏãú
  const loadingDiv = document.createElement('div');
  loadingDiv.className = 'gfnew-infinite-loading';
  loadingDiv.innerHTML = '<div class="gfnew-loading-spinner"></div>';
  grid.appendChild(loadingDiv);
  
  // üÜï Îã§Ïùå ÌîÑÎ†àÏûÑÏóêÏÑú Ïã§Ìñâ
  requestAnimationFrame(() => {
    setTimeout(() => {
      const currentCount = visibleProductsCount;
      visibleProductsCount = Math.min(visibleProductsCount + 8, allFilteredProducts.length);
      
      // Î°úÎî© Ïä§ÌîºÎÑà Ï†úÍ±∞
      if (loadingDiv) {
        loadingDiv.remove();
      }
      
      // üÜï Î∞∞Ïπò Î†åÎçîÎßÅÏúºÎ°ú ÏÉà Ï†úÌíà Ï∂îÍ∞Ä
      renderProductBatch(currentCount);
      
      isLoadingMore = false;
    }, 300); // Î°úÎî© Ìö®Í≥ºÎ•º ÏúÑÌïú ÏïΩÍ∞ÑÏùò ÎîúÎ†àÏù¥
  });
}

// üî• Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Ï≤òÎ¶¨ - Îçî Î∂ÄÎìúÎüΩÍ≤å ÏàòÏ†ï
function handleInfiniteScroll(e) {
  const modalBody = e.target;
  const scrollBottom = modalBody.scrollHeight - modalBody.scrollTop - modalBody.clientHeight;
  
  // üî• Ïä§ÌÅ¨Î°§Ïù¥ Î∞îÎã•ÏóêÏÑú 150px Ïù¥ÎÇ¥Ïù¥Í≥† Îçî Î°úÎìúÌï† Ï†úÌíàÏù¥ ÏûàÏúºÎ©¥ ÏûêÎèô Î°úÎî©
  if (scrollBottom < 150 && allFilteredProducts.length > visibleProductsCount && !isLoadingMore) {
    loadMoreProducts();
  }
}

// üî• Ï†úÌíà Ïπ¥Îìú ÏÉùÏÑ± Ìï®Ïàò - Íµ¨Îß§ Í∞ÄÍ≤©ÏóêÎßå Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï® Ï†ÅÏö© + VAT Ìè¨Ìï®ÏúºÎ°ú Î≥ÄÍ≤Ω
function createProductCard(product) {
  const isSelected = tempSelectedProducts.some(p => p.id === product.id);
  
  // üî• Í∞ÄÍ≤© Í≥ÑÏÇ∞: Î†åÌÉàÏùÄ Ïù¥ÎØ∏ Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®, Íµ¨Îß§Îßå Î∂ÄÍ∞ÄÏÑ∏ Ï∂îÍ∞Ä
  let price;
  if (currentFormType === 'rental') {
    // Î†åÌÉà: Ïù¥ÎØ∏ Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®Îêú Í∞ÄÍ≤© ÏÇ¨Ïö© (ÏàòÏ†ï ÏïàÌï®)
    const currentPeriod = getCurrentRentalPeriod();
    const originalPrice = product.originalRentalPrice || product.rentalPrice;
    const calculatedPrice = calculateRentalPrice(originalPrice, currentPeriod);
    price = `Ïõî ${formatNumber(calculatedPrice)}Ïõê`;
  } else {
    // üî• Íµ¨Îß§: Î∂ÄÍ∞ÄÏÑ∏ 10% Ï∂îÍ∞Ä
    const vatIncludedPrice = Math.round(product.price * 1.1);
    price = `${formatNumber(vatIncludedPrice)}Ïõê`;
  }
  
  const card = document.createElement('div');
  card.className = `gfnew-product-card ${isSelected ? 'selected' : ''}`;
  card.onclick = (e) => toggleProduct(product.id, e);
  
  // üî• Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ - images Î∞∞Ïó¥ ÏÇ¨Ïö©
  const img = document.createElement('img');
  img.className = 'gfnew-card-img';
  img.alt = product.name;
  img.loading = 'lazy';
  
  // üî• images Î∞∞Ïó¥ÏóêÏÑú Ï≤´ Î≤àÏß∏ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©
  const mainImage = product.images && product.images.length > 0 
    ? product.images[0] 
    : '/products/images/placeholder.jpg';
  const thumbnailUrl = mainImage.includes('?w=') 
    ? mainImage.replace(/\?w=\d+/, '?w=150') 
    : mainImage + '?w=150';
  
  // üÜï ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî Î∞∞Í≤ΩÏÉâ
  img.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
  
  // üÜï Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïù¥Î≤§Ìä∏
  img.onload = function() {
    this.style.backgroundColor = 'transparent';
  };
  
  // üÜï Ï∫êÏãúÎêú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Î∞îÎ°ú ÏÇ¨Ïö©
  if (imageCache.has(thumbnailUrl)) {
    img.src = thumbnailUrl;
  } else {
    // ÏóÜÏúºÎ©¥ ÏßÄÏó∞ Î°úÎìú
    img.dataset.src = thumbnailUrl;
    lazyLoadImage(img);
  }
  
  // üÜï Ïù¥ÎØ∏ÏßÄ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ± (ÌîÑÎ°úÎ™®ÏÖò ÏïÑÏù¥ÏΩòÏùÑ ÏúÑÌï¥)
  const imgContainer = document.createElement('div');
  imgContainer.className = 'gfnew-card-img-container';
  imgContainer.style.cssText = 'position: relative;';
  imgContainer.appendChild(img);

  // üÜï ÌîÑÎ°úÎ™®ÏÖò Ï†úÌíàÏù∏ Í≤ΩÏö∞ Ïä§ÌååÌÅ¥ ÏïÑÏù¥ÏΩò Ï∂îÍ∞Ä
  if (product.badge === 'PROMOTION') {
    const promotionIcon = document.createElement('div');
    promotionIcon.className = 'gfnew-promotion-icon';
    promotionIcon.innerHTML = `
      <svg style="width: 14px; height: 14px; fill: #e63946;" viewBox="0 0 24 26">
        <path d="M12 2l4 8 8 4-8 4-4 8-4-8-8-4 8-4z"/>
      </svg>
    `;
    promotionIcon.style.cssText = `
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    `;
    imgContainer.appendChild(promotionIcon);
  }
  
  // üî• ÏÉàÎ°úÏö¥ Íµ¨Ï°∞Î°ú Ï†ïÎ≥¥ ÏòÅÏó≠ ÏÉùÏÑ± + VAT Ìè¨Ìï®ÏúºÎ°ú Î≥ÄÍ≤Ω
  const info = document.createElement('div');
  info.className = 'gfnew-card-info';
  info.innerHTML = `
    <div class="gfnew-card-text-group">
      <h4 class="gfnew-card-name">${product.name}</h4>
      <p class="gfnew-card-desc">Ï†úÌíàÏΩîÎìú: ${product.code}</p>
    </div>
    <div class="gfnew-card-price-group">
      <p class="gfnew-card-price">${price}</p>
      <p class="gfnew-card-vat">VAT Ìè¨Ìï®</p>
    </div>
  `;
  
  const check = document.createElement('div');
  check.className = 'gfnew-card-check';
  
  card.appendChild(imgContainer);
  card.appendChild(info);
  card.appendChild(check);
  
  return card;
}

// üÜï Ïù¥ÎØ∏ÏßÄ ÏßÄÏó∞ Î°úÎìú Ìï®Ïàò
function lazyLoadImage(img) {
  const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const image = entry.target;
        const src = image.dataset.src;
        
        if (src) {
          preloadImage(src); // Ï∫êÏãúÏóê Ï†ÄÏû•
          image.src = src;
          image.removeAttribute('data-src');
        }
        
        observer.unobserve(image);
      }
    });
  });
  
  imageObserver.observe(img);
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      PRODUCT INTERACTION                                  ‚ñà‚ñà
‚ñà‚ñà                         Ï†úÌíà ÏÉÅÌò∏ÏûëÏö© Í¥ÄÎ¶¨                                   ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ï†úÌíà ÌïÑÌÑ∞ÎßÅ - ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ
function filterProducts(category, event) {
  // ÎìúÎûòÍ∑∏Î°ú Ïù∏Ìïú ÌÅ¥Î¶≠Ïù¥Î©¥ Î¨¥Ïãú
  if (event && event.target.dataset.dragging === 'true') {
    event.target.dataset.dragging = 'false';
    return;
  }
  
  // Î™®Îì† ÌÉ≠Ïùò active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
  document.querySelectorAll('.gfnew-filter-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // ÌÅ¥Î¶≠Îêú ÌÉ≠Ïóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
  if (event && event.target) {
    event.target.classList.add('active');
  }
  
  // üî• Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ìïë (HTML onclickÍ≥º ÏùºÏπòÌïòÎèÑÎ°ù ÏàòÏ†ï)
  let mappedCategory;
  switch(category) {
    case 'all':
      mappedCategory = 'all';
      break;
    case 'Promotion':
      mappedCategory = 'promotion';
      break;
    case 'Weight':
      mappedCategory = 'Weight';
      break;
    case 'Free weights':
      mappedCategory = 'Free weights';
      break;
    case 'Cardio':
      mappedCategory = 'Cardio';
      break;
    default:
      mappedCategory = category;
  }
  
  window.currentCategory = mappedCategory;
  
  // Ï¥àÍ∏∞ Ï†úÌíà Ïàò Î¶¨ÏÖã
  visibleProductsCount = 8;
  
  // üÜï Î°úÎî© ÌëúÏãú
  const grid = document.getElementById('productGrid');
  if (grid) {
    grid.innerHTML = '<div class="gfnew-loading"><div class="gfnew-loading-spinner"></div></div>';
    
    // üÜï Îã§Ïùå ÌîÑÎ†àÏûÑÏóêÏÑú Î†åÎçîÎßÅ
    requestAnimationFrame(() => {
      renderProductsOptimized(mappedCategory);
    });
  }
}

// Ï†úÌíà ÏÑ†ÌÉù/Ìï¥Ï†ú - Î†åÌÉà Í∏∞Í∞ÑÎ≥Ñ Í∞ÄÍ≤© Ï†ÅÏö©
function toggleProduct(productId, event) {
  event.stopPropagation();
  
  const product = products.find(p => p.id === productId);
  const index = tempSelectedProducts.findIndex(p => p.id === productId);
  
  const clickedCard = event.currentTarget;
  
  if (index > -1) {
    tempSelectedProducts.splice(index, 1);
    clickedCard.classList.remove('selected');
    clickedCard.removeAttribute('style');
  } else {
    // üî• Î†åÌÉà Ï†úÌíàÏù∏ Í≤ΩÏö∞ ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞ÑÏóê ÎßûÎäî Í∞ÄÍ≤© Ï†ÅÏö©
    const productToAdd = {...product, quantity: 1};
    
    if (currentFormType === 'rental') {
      const currentPeriod = getCurrentRentalPeriod();
      const originalPrice = product.rentalPrice;
      productToAdd.originalRentalPrice = originalPrice; // ÏõêÎ≥∏ Í∞ÄÍ≤© Ï†ÄÏû•
      productToAdd.rentalPrice = calculateRentalPrice(originalPrice, currentPeriod);
    }
    
    tempSelectedProducts.push(productToAdd);
    clickedCard.classList.add('selected');
    
    if (window.innerWidth <= 768) {
      clickedCard.style.cssText = 
        'background: rgba(230, 57, 70, 0.12) !important;' +
        'border: 2px solid #e63946 !important;' +
        'box-shadow: 0 0 8px rgba(230, 57, 70, 0.4) !important;';
    }
  }
  
  updateSelectionCount();
}

// ÏÑ†ÌÉù Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
function updateSelectionCount() {
  const countElement = document.getElementById('selectionCount');
  if (countElement) {
    countElement.textContent = tempSelectedProducts.length;
  }
}

// ÏÑ†ÌÉù ÏôÑÎ£å
function confirmSelection() {
  selectedProducts[currentFormType] = [...tempSelectedProducts];
  renderSelectedProducts();
  closeProductModal();
  
  if (currentFormType === 'purchase') {
    updateBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Íµ¨Îß§)
    validateProductSelection('purchase');
  } else if (currentFormType === 'rental') {
    updateRentalBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Î†åÌÉà)
    validateProductSelection('rental');
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      INFINITE SCROLL & LOADING                            ‚ñà‚ñà
‚ñà‚ñà                         Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Î∞è Î°úÎî©                                  ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Îçî ÎßéÏùÄ Ï†úÌíà Î°úÎìú - Í∞úÏÑ†
function loadMoreProducts() {
  if (isLoadingMore) return;
  isLoadingMore = true;
  
  const grid = document.getElementById('productGrid');
  const loadMoreBtn = grid.querySelector('.gfnew-load-more');
  if (loadMoreBtn) {
    loadMoreBtn.innerHTML = '<div class="gfnew-loading-spinner"></div>';
  }
  
  // üÜï Îã§Ïùå ÌîÑÎ†àÏûÑÏóêÏÑú Ïã§Ìñâ
  requestAnimationFrame(() => {
    setTimeout(() => {
      const currentCount = visibleProductsCount;
      visibleProductsCount = Math.min(visibleProductsCount + 8, allFilteredProducts.length);
      
      // Î°úÎìú Îçî Î≤ÑÌäº Ï†úÍ±∞
      if (loadMoreBtn) {
        loadMoreBtn.remove();
      }
      
      // üÜï Î∞∞Ïπò Î†åÎçîÎßÅÏúºÎ°ú ÏÉà Ï†úÌíà Ï∂îÍ∞Ä
      renderProductBatch(currentCount);
      
      isLoadingMore = false;
    }, 100);
  });
}

// üî• Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Ï≤òÎ¶¨
function handleInfiniteScroll(e) {
  const modalBody = e.target;
  const scrollBottom = modalBody.scrollHeight - modalBody.scrollTop - modalBody.clientHeight;
  
  // Ïä§ÌÅ¨Î°§Ïù¥ Î∞îÎã•ÏóêÏÑú 100px Ïù¥ÎÇ¥Ïù¥Í≥† Îçî Î°úÎìúÌï† Ï†úÌíàÏù¥ ÏûàÏúºÎ©¥
  if (scrollBottom < 100 && allFilteredProducts.length > visibleProductsCount && !isLoadingMore) {
    loadMoreProducts();
  }
}

// Î™®Îã¨ ÏÑ∏Î°ú Ïä§ÌÅ¨Î°§ Ìï∏Îì§Îü¨
function handleModalScroll(e) {
  const modalBody = e.target;
  modalBody.classList.add('scrolling');
  
  clearTimeout(scrollTimer);
  scrollTimer = setTimeout(() => {
    modalBody.classList.remove('scrolling');
  }, 1500);
}



/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                     SELECTED PRODUCTS MANAGEMENT                          ‚ñà‚ñà
‚ñà‚ñà                        ÏÑ†ÌÉùÎêú Ï†úÌíà Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú                                ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• ÏÑ†ÌÉùÎêú Ï†úÌíà Î†åÎçîÎßÅ - VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏ Ï∂îÍ∞Ä ÏôÑÎ£åÌåê
function renderSelectedProducts() {
  const listId = currentFormType === 'purchase' ? 'purchase-products' : 'rental-products';
  const list = document.getElementById(listId);
  
  if (!list) return;
  
  if (selectedProducts[currentFormType].length === 0) {
    list.classList.remove('show');
    
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù (Íµ¨ÏûÖ + Î†åÌÉà Î™®Îëê)
    if (currentFormType === 'purchase' || currentFormType === 'rental') {
      validateProductSelection(currentFormType);
    }
    
    return;
  }
  
  list.classList.add('show');
  list.innerHTML = '';
  
  // DocumentFragment ÏÇ¨Ïö©ÏúºÎ°ú DOM Ï°∞Ïûë ÏµúÏ†ÅÌôî
  const fragment = document.createDocumentFragment();
  
  selectedProducts[currentFormType].forEach((product, index) => {
    // üî• Í∞ÄÍ≤© Í≥ÑÏÇ∞: Î†åÌÉàÏùÄ Ïù¥ÎØ∏ Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®, Íµ¨Îß§Îßå Î∂ÄÍ∞ÄÏÑ∏ Ï∂îÍ∞Ä
    let price;
    if (currentFormType === 'rental') {
      // Î†åÌÉà: Ïù¥ÎØ∏ Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®Îêú Í∞ÄÍ≤© ÏÇ¨Ïö© (ÏàòÏ†ï ÏïàÌï®)
      const currentPeriod = getCurrentRentalPeriod();
      const originalPrice = product.originalRentalPrice || product.rentalPrice;
      const calculatedPrice = calculateRentalPrice(originalPrice, currentPeriod);
      price = `Ïõî ${formatNumber(calculatedPrice)}Ïõê`;
    } else {
      // üî• Íµ¨Îß§: Î∂ÄÍ∞ÄÏÑ∏ 10% Ï∂îÍ∞Ä
      const vatIncludedPrice = Math.round(product.price * 1.1);
      price = `${formatNumber(vatIncludedPrice)}Ïõê`;
    }
    
    const mainImage = product.images && product.images.length > 0 
      ? product.images[0] 
      : '/products/images/placeholder.jpg';
    const imageUrl = mainImage.includes('?w=300') 
      ? mainImage 
      : mainImage + '?w=300';
    
    const itemDiv = document.createElement('div');
    itemDiv.className = 'gfnew-product-item';
    itemDiv.style.cssText = 
      'background: rgba(255, 255, 255, 0.03) !important;' +
      'border-color: rgba(255, 255, 255, 0.15) !important;' +
      'transform: translateZ(0);' +
      '-webkit-transform: translateZ(0);' +
      'will-change: auto;' +
      'backface-visibility: hidden;' +
      '-webkit-backface-visibility: hidden;';
    
    // üî• Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î°úÎìúÏôÄ Î°úÎî© ÏµúÏ†ÅÌôî
    const img = new Image();
    img.className = 'gfnew-product-img';
    img.alt = product.name;
    img.src = imageUrl;
    img.style.cssText = 
      'opacity: 0;' +
      'transition: opacity 0.2s ease;';
    
    // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å Ïãú ÌéòÏù¥ÎìúÏù∏
    img.onload = function() {
      this.style.opacity = '1';
    };
    
    // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå® Ïãú Í∏∞Î≥∏ Î∞∞Í≤Ω
    img.onerror = function() {
      this.style.opacity = '1';
      this.style.background = 'rgba(255, 255, 255, 0.05)';
    };
    
    // üî• VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏ Ï∂îÍ∞ÄÎêú HTML Íµ¨Ï°∞
    itemDiv.innerHTML = `
      <div class="gfnew-product-top">
        <div class="gfnew-product-img-wrapper"></div>
        <div class="gfnew-product-info">
          <h4 class="gfnew-product-name">${product.name}</h4>
          <p class="gfnew-product-code">${product.code}</p>
          <div class="gfnew-price-group">
            <p class="gfnew-product-price">${price}</p>
            <p class="gfnew-product-vat">VAT Ìè¨Ìï®</p>
          </div>
        </div>
      </div>
      <div class="gfnew-product-controls">
        <div class="gfnew-qty-control">
          <button class="gfnew-qty-btn" onclick="changeQuantity('${currentFormType}', ${index}, -1)">-</button>
          <span class="gfnew-qty-value">${product.quantity}</span>
          <button class="gfnew-qty-btn" onclick="changeQuantity('${currentFormType}', ${index}, 1)">+</button>
        </div>
        <button class="gfnew-delete-btn" onclick="removeProduct('${currentFormType}', ${index})">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `;
    
    // Ïù¥ÎØ∏ÏßÄÎ•º wrapperÏóê Ï∂îÍ∞Ä
    const imgWrapper = itemDiv.querySelector('.gfnew-product-img-wrapper');
    imgWrapper.appendChild(img);
    
    fragment.appendChild(itemDiv);
  });
  
  list.appendChild(fragment);
  
  // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù (Íµ¨ÏûÖ + Î†åÌÉà Î™®Îëê)
  if (currentFormType === 'purchase' || currentFormType === 'rental') {
    validateProductSelection(currentFormType);
  }
}

// ÏàòÎüâ Î≥ÄÍ≤Ω
function changeQuantity(formType, index, change) {
  const product = selectedProducts[formType][index];
  product.quantity = Math.max(1, product.quantity + change);
  currentFormType = formType;
  renderSelectedProducts();
  
  if (formType === 'purchase') {
    updateBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Íµ¨Îß§)
    validateProductSelection('purchase');
  } else if (formType === 'rental') {
    updateRentalBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Î†åÌÉà)
    validateProductSelection('rental');
  }
}

// Ï†úÌíà ÏÇ≠Ï†ú
function removeProduct(formType, index) {
  selectedProducts[formType].splice(index, 1);
  currentFormType = formType;
  renderSelectedProducts();
  
  if (formType === 'purchase') {
    updateBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Íµ¨Îß§)
    validateProductSelection('purchase');
  } else if (formType === 'rental') {
    updateRentalBudgetComparison();
    // üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù Ìò∏Ï∂ú (Î†åÌÉà)
    validateProductSelection('rental');
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Íµ¨Îß§ Í≤¨Ï†ÅÏÑú - ÏòàÏÇ∞ ÎπÑÍµê Ìï®Ïàò                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ï¥ù Í∞ÄÍ≤© Í≥ÑÏÇ∞ Ìï®Ïàò - Î∂ÄÍ∞ÄÏÑ∏ Ìè¨Ìï®ÏúºÎ°ú ÏàòÏ†ï
function calculateTotalPrice() {
  return selectedProducts.purchase.reduce((total, product) => {
    // üî• Í∞Å Ï†úÌíà Í∞ÄÍ≤©Ïóê Î∂ÄÍ∞ÄÏÑ∏ 10% Ìè¨Ìï®ÌïòÏó¨ Í≥ÑÏÇ∞
    const vatIncludedPrice = Math.round(product.price * 1.1);
    return total + (vatIncludedPrice * product.quantity);
  }, 0);
}

// üî• Ï¥ù Ï†úÌíà Í∞úÏàò Í≥ÑÏÇ∞ Ìï®Ïàò (ÏàòÎüâ Ìè¨Ìï®)
function calculateTotalProductCount(formType) {
  return selectedProducts[formType].reduce((total, product) => {
    return total + product.quantity;
  }, 0);
}


// üî• ÏòàÏÇ∞ ÎπÑÍµê ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò - VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏ Ï∂îÍ∞Ä
function updateBudgetComparison() {
  const budgetInput = document.getElementById('purchase-budget');
  const budgetCompare = document.getElementById('purchase-budget-compare');
  
  if (!budgetInput || !budgetCompare) return;
  
  // üî• Î†åÌÉà Í≤¨Ï†ÅÏÑúÎäî Ïà®Í∏∞Í∏∞
  const rentalBudget = document.getElementById('rental-budget-compare');
  if (rentalBudget) rentalBudget.style.display = 'none';
  
  const budgetValue = extractNumber(budgetInput.value);
  const totalPrice = calculateTotalPrice();
  const productCount = calculateTotalProductCount('purchase');
  
  // Ï†úÌíàÏù¥ ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Í≤¨Ï†ÅÏÑú ÏÑπÏÖò ÌëúÏãú
  if (selectedProducts.purchase.length > 0) {
    budgetCompare.style.display = 'block';
    
    // ÏòàÏÇ∞ ÏÉÅÌÉúÏóê Îî∞Î•∏ ÌÅ¥ÎûòÏä§ Í≥ÑÏÇ∞
    let cardClass = '';
    if (budgetValue > 0) {
      const percentage = (totalPrice / budgetValue) * 100;
      if (percentage <= 70) {
        cardClass = 'has-budget budget-good';
      } else if (percentage <= 100) {
        cardClass = 'has-budget budget-warning';
      } else {
        cardClass = 'has-budget budget-over';
      }
    }
    
    // üî• VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏Í∞Ä Ï∂îÍ∞ÄÎêú ÏÉàÎ°úÏö¥ HTML Íµ¨Ï°∞
    budgetCompare.innerHTML = `
      <div class="gfnew-estimate-card ${cardClass}">
        <div class="gfnew-estimate-header">
          <h4>ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú</h4>
        </div>
        
        <div class="gfnew-amount-display">
          <div class="gfnew-total-label">Ï¥ù Íµ¨Îß§ Í∏àÏï°</div>
          <div class="gfnew-total-amount">${formatNumber(totalPrice)}Ïõê</div>
          <div class="gfnew-vat-notice">VAT Ìè¨Ìï®</div>
        </div>
        
        <div class="gfnew-detail-grid">
          <div class="gfnew-detail-item">
            <span class="gfnew-detail-label">ÏÑ†ÌÉù Ï†úÌíà</span>
            <span class="gfnew-detail-value">${selectedProducts.purchase.length}Ï¢Ö</span>
          </div>
          <div class="gfnew-detail-item">
            <span class="gfnew-detail-label">Ï¥ù ÏàòÎüâ</span>
            <span class="gfnew-detail-value">${productCount}Í∞ú</span>
          </div>
        </div>
        
        ${budgetValue > 0 ? `
          <div class="gfnew-budget-section">
            <div class="gfnew-budget-header">
              <span class="gfnew-budget-label">ÏòàÏÉÅ ÏòàÏÇ∞</span>
              <span class="gfnew-budget-amount">${formatNumber(budgetValue)}Ïõê</span>
            </div>
            
            <div class="gfnew-budget-analysis" style="display: block;">
              ${createGaugeBar(totalPrice, budgetValue, 'purchase')}
            </div>
          </div>
        ` : `
          <div class="gfnew-budget-section">
            <div class="gfnew-budget-header">
              <span class="gfnew-budget-label">ÏòàÏÉÅ ÏòàÏÇ∞</span>
              <span class="gfnew-budget-amount no-budget">ÏòàÏÇ∞ÏùÑ ÏûÖÎ†•ÌïòÎ©¥ ÎπÑÍµê Î∂ÑÏÑùÏù¥ ÌëúÏãúÎê©ÎãàÎã§</span>
            </div>
          </div>
        `}
        
        <div class="gfnew-discount-notice">
          <p>
            <i class="fas fa-info-circle"></i>
            Ìï¥Îãπ Í≤¨Ï†ÅÏùÄ ÏòàÏãú Í≤¨Ï†ÅÏù¥Î©∞, Í≤¨Ï†ÅÏÑú ÏûëÏÑ±ÏùÑ ÏôÑÎ£åÌïòÏó¨ Î∞úÏÜ°Ìï¥Ï£ºÏãúÎ©¥ Íµ¨Îß§ ÏàòÎüâ ÎòêÎäî Í∞ÄÍ≤©Ïóê Îî∞Îùº Ï∂îÍ∞Ä Ìï†Ïù∏Ïú® Ï†ÅÏö©Ïù¥ ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.
          </p>
        </div>
      </div>
    `;
  } else {
    budgetCompare.style.display = 'none';
  }
}


/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Î†åÌÉà Í≤¨Ï†ÅÏÑú - ÏòàÏÇ∞ ÎπÑÍµê Ìï®Ïàò (ÏàòÏ†ï)                     ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Î†åÌÉà Ï¥ù Í∞ÄÍ≤© Í≥ÑÏÇ∞ Ìï®Ïàò - ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞ÑÏóê Îî∞Îùº Í≥ÑÏÇ∞
function calculateTotalRentalPrice() {
  const currentPeriod = getCurrentRentalPeriod();
  
  return selectedProducts.rental.reduce((total, product) => {
    const originalPrice = product.originalRentalPrice || product.rentalPrice;
    const calculatedPrice = calculateRentalPrice(originalPrice, currentPeriod);
    return total + (calculatedPrice * product.quantity);
  }, 0);
}

// üî• Î†åÌÉà ÏòàÏÇ∞ ÎπÑÍµê ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò - VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏ Ï∂îÍ∞Ä
function updateRentalBudgetComparison() {
  const budgetInput = document.getElementById('rental-budget');
  const budgetCompare = document.getElementById('rental-budget-compare');
  
  if (!budgetInput || !budgetCompare) return;
  
  // üî• Íµ¨Îß§ Í≤¨Ï†ÅÏÑúÎäî Ïà®Í∏∞Í∏∞
  const purchaseBudget = document.getElementById('purchase-budget-compare');
  if (purchaseBudget) purchaseBudget.style.display = 'none';
  
  const budgetValue = extractNumber(budgetInput.value);
  const totalPrice = calculateTotalRentalPrice();
  const productCount = calculateTotalProductCount('rental');
  
  // Ï†úÌíàÏù¥ ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Í≤¨Ï†ÅÏÑú ÏÑπÏÖò ÌëúÏãú
  if (selectedProducts.rental.length > 0) {
    budgetCompare.style.display = 'block';
    
    // ÏòàÏÇ∞ ÏÉÅÌÉúÏóê Îî∞Î•∏ ÌÅ¥ÎûòÏä§ Í≥ÑÏÇ∞
    let cardClass = '';
    if (budgetValue > 0) {
      const percentage = (totalPrice / budgetValue) * 100;
      if (percentage <= 70) {
        cardClass = 'has-budget budget-good';
      } else if (percentage <= 100) {
        cardClass = 'has-budget budget-warning';
      } else {
        cardClass = 'has-budget budget-over';
      }
    }
    
    // üî• VAT Ìè¨Ìï® ÌÖçÏä§Ìä∏Í∞Ä Ï∂îÍ∞ÄÎêú ÏÉàÎ°úÏö¥ HTML Íµ¨Ï°∞
    budgetCompare.innerHTML = `
      <div class="gfnew-estimate-card ${cardClass}">
        <div class="gfnew-estimate-header">
          <h4>ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú</h4>
        </div>
        
        <div class="gfnew-amount-display">
          <div class="gfnew-total-label">Ïõî Î†åÌÉàÎ£å</div>
          <div class="gfnew-total-amount">${formatNumber(totalPrice)}Ïõê</div>
          <div class="gfnew-vat-notice">VAT Ìè¨Ìï®</div>
        </div>
        
        <div class="gfnew-detail-grid">
          <div class="gfnew-detail-item">
            <span class="gfnew-detail-label">ÏÑ†ÌÉù Ï†úÌíà</span>
            <span class="gfnew-detail-value">${selectedProducts.rental.length}Ï¢Ö</span>
          </div>
          <div class="gfnew-detail-item">
            <span class="gfnew-detail-label">Ï¥ù ÏàòÎüâ</span>
            <span class="gfnew-detail-value">${productCount}Í∞ú</span>
          </div>
        </div>
        
        ${budgetValue > 0 ? `
          <div class="gfnew-budget-section">
            <div class="gfnew-budget-header">
              <span class="gfnew-budget-label">Ïõî ÏòàÏÇ∞</span>
              <span class="gfnew-budget-amount">${formatNumber(budgetValue)}Ïõê</span>
            </div>
            
            <div class="gfnew-budget-analysis" style="display: block;">
              ${createGaugeBar(totalPrice, budgetValue, 'rental')}
            </div>
          </div>
        ` : `
          <div class="gfnew-budget-section">
            <div class="gfnew-budget-header">
              <span class="gfnew-budget-label">Ïõî ÏòàÏÇ∞</span>
              <span class="gfnew-budget-amount no-budget">ÏòàÏÇ∞ÏùÑ ÏûÖÎ†•ÌïòÎ©¥ ÎπÑÍµê Î∂ÑÏÑùÏù¥ ÌëúÏãúÎê©ÎãàÎã§</span>
            </div>
          </div>
        `}
        
        <div class="gfnew-discount-notice">
          <p>
            <i class="fas fa-info-circle"></i>
            Ìï¥Îãπ Í≤¨Ï†ÅÏùÄ ÏòàÏãú Í≤¨Ï†ÅÏù¥Î©∞, Í≤¨Ï†ÅÏÑú Î∞úÏÜ° Ïãú ÏÇ¨ÏóÖÏûê Îì±Î°ùÏ¶ù ÌòπÏùÄ Ïã†Î∂ÑÏ¶ùÏùÑ Ï≤®Î∂ÄÌï¥Ï£ºÏãúÎ©¥ Îçî Ï†ïÌôïÌïú Í∞ÄÍ≤©ÏùÑ ÌöåÏã†ÎìúÎ¶¥ Ïàò ÏûàÏäµÎãàÎã§.
          </p>
        </div>
      </div>
    `;
  } else {
    budgetCompare.style.display = 'none';
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Í≤åÏù¥ÏßÄÎ∞î ÏÉùÏÑ± Ìó¨Ìçº Ìï®Ïàò                                ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Í≤åÏù¥ÏßÄÎ∞îÏôÄ ÏÉÅÌÉú Î©îÏãúÏßÄ ÏÉùÏÑ± Ìï®Ïàò
function createGaugeBar(totalPrice, budgetValue, type) {
  const percentage = (totalPrice / budgetValue) * 100;
  const percentageDisplay = Math.round(percentage);
  
  let statusClass = 'good';
  let statusIcon = 'fa-check-circle';
  let statusMessage = '';
  let gaugeColor = 'linear-gradient(90deg, #2ecc71, #27ae60)';
  
  if (percentage <= 70) {
    statusClass = 'good';
    statusIcon = 'fa-check-circle';
    statusMessage = `ÏòàÏÇ∞ ÎÇ¥ÏóêÏÑú Ïó¨Ïú†ÏûàÍ≤å ÏÑ†ÌÉùÌïòÏÖ®ÏäµÎãàÎã§.`;
    gaugeColor = 'linear-gradient(90deg, #2ecc71, #27ae60)';
  } else if (percentage <= 100) {
    statusClass = 'warning';
    statusIcon = 'fa-exclamation-circle';
    statusMessage = `ÏòàÏÇ∞Ïóê Í∑ºÏ†ëÌïú ÏÑ†ÌÉùÏûÖÎãàÎã§.`;
    gaugeColor = 'linear-gradient(90deg, #f1c40f, #f39c12)';
  } else {
    statusClass = 'over';
    statusIcon = 'fa-times-circle';
    const overAmount = formatNumber(totalPrice - budgetValue);
    statusMessage = `ÏòàÏÇ∞ÏùÑ ${overAmount}Ïõê Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.`;
    gaugeColor = 'linear-gradient(90deg, #e74c3c, #c0392b)';
  }
  
  // Ïõî Î†åÌÉàÏùò Í≤ΩÏö∞ Î©îÏãúÏßÄ Ï°∞Ï†ï
  if (type === 'rental' && statusClass === 'good') {
    statusMessage = `Ïõî Î†åÌÉà ÏòàÏÇ∞ ÎÇ¥ÏóêÏÑú Ïó¨Ïú†ÏûàÍ≤å ÏÑ†ÌÉùÌïòÏÖ®ÏäµÎãàÎã§.`;
  } else if (type === 'rental' && statusClass === 'warning') {
    statusMessage = `Ïõî Î†åÌÉà ÏòàÏÇ∞Ïóê Í∑ºÏ†ëÌïú ÏÑ†ÌÉùÏûÖÎãàÎã§.`;
  } else if (type === 'rental' && statusClass === 'over') {
    const overAmount = formatNumber(totalPrice - budgetValue);
    statusMessage = `Ïõî Î†åÌÉà ÏòàÏÇ∞ÏùÑ ${overAmount}Ïõê Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.`;
  }
  
  return `
    <div class="gfnew-gauge-container">
      <div class="gfnew-gauge-track">
        <div class="gfnew-gauge-fill" style="width: ${Math.min(percentageDisplay, 100)}%; background: ${gaugeColor};">
          <span class="gfnew-gauge-percent">${percentageDisplay}%</span>
        </div>
      </div>
    </div>
    <div class="gfnew-budget-status ${statusClass}">
      <i class="fas ${statusIcon}"></i>
      <span>${statusMessage}</span>
    </div>
  `;
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      ÏòàÏÇ∞ ÎπÑÍµê Ìï®Ïàò ÏàòÏ†ï ÎÅù                                 ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      GOOGLE APPS SCRIPT ÏÑ§Ï†ï                              ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ïó¨Í∏∞Ïóê Google Apps Script URLÏùÑ ÎÑ£Ïñ¥Ï£ºÏÑ∏Ïöî!
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwGWBV9cosYHkstEyqhB5avOHGGMLmcNLH1njkaQTrmeoPKbXSzckTuxiKKJ104ALX31w/exec';

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Î°úÎî© Î™®Îã¨ Ìï®Ïàò                                        ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Î°úÎî© Î™®Îã¨ ÌëúÏãú
function showLoadingModal() {
  // Î°úÎî© Î™®Îã¨ HTML ÏÉùÏÑ±
  const loadingModal = document.createElement('div');
  loadingModal.id = 'contact-loading-modal';
  loadingModal.className = 'gf-loading-screen';
  
  loadingModal.innerHTML = `
    <div class="gf-loading-container">
      <!-- Î°úÎî© Ïä§ÌîºÎÑà -->
      <div class="gf-loading-spinner">
        <!-- Background static SVG -->
        <svg width="200px" height="160px" viewBox="0 0 187.3 93.7">
          <path d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1 c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z" />
        </svg>
        
        <!-- Main animated SVG -->
        <svg width="200px" height="160px" viewBox="0 0 187.3 93.7">
          <defs>
            <linearGradient id="gf-loading-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#ff0066" />
              <stop offset="25%" stop-color="lime" />
              <stop offset="50%" stop-color="cyan" />
              <stop offset="75%" stop-color="magenta" />
              <stop offset="100%" stop-color="orange" />
            </linearGradient>
          </defs>
          <path d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1 c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z" />
        </svg>
        
        <!-- Blurred overlay SVG -->
        <svg width="200px" height="160px" viewBox="0 0 187.3 93.7">
          <defs>
            <linearGradient id="gf-loading-gradient-blur" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#ff0066" />
              <stop offset="25%" stop-color="lime" />
              <stop offset="50%" stop-color="cyan" />
              <stop offset="75%" stop-color="magenta" />
              <stop offset="100%" stop-color="orange" />
            </linearGradient>
          </defs>
          <path d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1 c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z" />
        </svg>
      </div>
      
      <!-- Î°úÎî© ÌÖçÏä§Ìä∏ (Î°úÍ≥† Ï†úÍ±∞) -->
      <div class="gf-loading-content">
        <p style="color: white; font-size: 18px; margin-bottom: 1rem;">Î¨∏ÏùòÎ•º Ï†ÑÏÜ° Ï§ëÏûÖÎãàÎã§</p>
        <div class="gf-loading-dots">
          <span>.</span>
          <span>.</span>
          <span>.</span>
        </div>
      </div>
    </div>
  `;
  
  // Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä (Ìïú Î≤àÎßå)
  if (!document.getElementById('loading-modal-style')) {
    const style = document.createElement('style');
    style.id = 'loading-modal-style';
    style.textContent = `
      /* Î°úÎî© Ïä§ÌÅ¨Î¶∞ - üî• Î∞∞Í≤Ω Ìà¨Î™ÖÎèÑ ÏàòÏ†ï */
      #contact-loading-modal.gf-loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);  /* üî• Í≤ÄÏùÄÏÉâ + 90% Ìà¨Î™ÖÎèÑ */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999999;
        transition: opacity 0.5s ease, visibility 0.5s ease;
        backdrop-filter: blur(5px);  /* üî• Îí§ Î∞∞Í≤Ω Î∏îÎü¨ Ìö®Í≥º Ï∂îÍ∞Ä */
      }
      
      /* Î°úÎî© Ïª®ÌÖåÏù¥ÎÑà */
      #contact-loading-modal .gf-loading-container {
        text-align: center;
        position: relative;
      }
      
      /* Î°úÎî© Ïä§ÌîºÎÑà */
      #contact-loading-modal .gf-loading-spinner {
        position: relative;
        margin-bottom: 3rem;
      }
      
      /* SVG Ïä§ÌÉÄÏùº */
      #contact-loading-modal .gf-loading-spinner svg {
        fill: none;
        stroke-width: 10;
        stroke-linecap: round;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      
      /* Ï≤´ Î≤àÏß∏ SVG - Î∞∞Í≤Ω */
      #contact-loading-modal .gf-loading-spinner svg:nth-child(1) {
        stroke: #222;
      }
      
      /* Îëê Î≤àÏß∏ SVG - Î©îÏù∏ Ïï†ÎãàÎ©îÏù¥ÏÖò */
      #contact-loading-modal .gf-loading-spinner svg:nth-child(2) {
        stroke: url(#gf-loading-gradient);
        stroke-dasharray: 60 172;
        animation: gfLoadingAnimate 0.5s linear infinite;
      }
      
      /* ÏÑ∏ Î≤àÏß∏ SVG - Î∏îÎü¨ Ìö®Í≥º */
      #contact-loading-modal .gf-loading-spinner svg:nth-child(3) {
        stroke: url(#gf-loading-gradient-blur);
        stroke-dasharray: 60 172;
        filter: blur(5px);
        animation: gfLoadingAnimate 1s linear infinite;
      }
      
      /* Î°úÎî© Ïï†ÎãàÎ©îÏù¥ÏÖò */
      @keyframes gfLoadingAnimate {
        0% { stroke-dashoffset: 0; }
        100% { stroke-dashoffset: 232; }
      }
      
      /* Î°úÎî© Ï†êÎì§ */
      #contact-loading-modal .gf-loading-dots {
        display: flex;
        justify-content: center;
        gap: 0.3rem;
      }
      
      #contact-loading-modal .gf-loading-dots span {
        color: #e63946 !important;
        font-size: 2rem !important;
        font-weight: bold !important;
        animation: gfLoadingDots 1.5s ease-in-out infinite;
      }
      
      #contact-loading-modal .gf-loading-dots span:nth-child(1) {
        animation-delay: 0s;
      }
      
      #contact-loading-modal .gf-loading-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }
      
      #contact-loading-modal .gf-loading-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }
      
      @keyframes gfLoadingDots {
        0%, 80%, 100% {
          opacity: 0.3;
          transform: scale(0.8);
        }
        40% {
          opacity: 1;
          transform: scale(1.2);
        }
      }
      
      /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
      @media (max-width: 768px) {
        #contact-loading-modal .gf-loading-spinner svg {
          width: 150px;
          height: 120px;
        }
        
        #contact-loading-modal .gf-loading-dots span {
          font-size: 1.5rem !important;
        }
      }
      
      @media (max-width: 480px) {
        #contact-loading-modal .gf-loading-spinner svg {
          width: 120px;
          height: 96px;
        }
        
        #contact-loading-modal .gf-loading-dots span {
          font-size: 1.2rem !important;
        }
      }
    `;
    document.head.appendChild(style);
  }
  
  document.body.appendChild(loadingModal);
}

// Î°úÎî© Î™®Îã¨ Ïà®Í∏∞Í∏∞
function hideLoadingModal() {
  const loadingModal = document.getElementById('contact-loading-modal');
  if (loadingModal) {
    loadingModal.remove();
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Î°úÎî© Î™®Îã¨ Ìï®Ïàò ÎÅù                                     ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Ïª§Ïä§ÌÖÄ ÏïåÎ¶ºÏ∞Ω Ìï®Ïàò                                    ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ïª§Ïä§ÌÖÄ ÏïåÎ¶ºÏ∞Ω ÌëúÏãú
function showCustomAlert(type, title, message) {
  // ÏïåÎ¶ºÏ∞Ω HTML ÏÉùÏÑ±
  const alertOverlay = document.createElement('div');
  alertOverlay.className = 'custom-alert-overlay';
  
  const iconHTML = type === 'success' 
    ? '<i class="fas fa-check"></i>' 
    : '<i class="fas fa-times"></i>';
  
  alertOverlay.innerHTML = `
    <div class="custom-alert-box">
      <div class="custom-alert-icon ${type}">
        ${iconHTML}
      </div>
      <h3 class="custom-alert-title">${title}</h3>
      <p class="custom-alert-message">${message}</p>
      <button class="custom-alert-button" onclick="closeCustomAlert()">ÌôïÏù∏</button>
    </div>
  `;
  
  document.body.appendChild(alertOverlay);
  
  // Ïï†ÎãàÎ©îÏù¥ÏÖòÏùÑ ÏúÑÌïú ÎîúÎ†àÏù¥
  setTimeout(() => {
    alertOverlay.classList.add('show');
  }, 10);
}

// Ïª§Ïä§ÌÖÄ ÏïåÎ¶ºÏ∞Ω Îã´Í∏∞
function closeCustomAlert() {
  const alertOverlay = document.querySelector('.custom-alert-overlay');
  if (alertOverlay) {
    alertOverlay.classList.remove('show');
    setTimeout(() => {
      alertOverlay.remove();
    }, 300);
  }
}

// Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Îì±Î°ù
window.closeCustomAlert = closeCustomAlert;

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      Ïª§Ïä§ÌÖÄ ÏïåÎ¶ºÏ∞Ω Ìï®Ïàò ÎÅù                                 ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ - ÌååÏùºÏùÑ Base64Î°ú Î≥ÄÌôòÌïòÏó¨ Ï†ÑÏÜ°                  ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ Î∂ÄÎ∂ÑÏùÑ Ïù¥ ÏΩîÎìúÎ°ú ÍµêÏ≤¥ÌïòÏÑ∏Ïöî
document.querySelectorAll('form').forEach(form => {
  form.addEventListener('submit', async function(e) {  // async Ï∂îÍ∞Ä!
    e.preventDefault();
    
    // üî• Google Script URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ Í≤ΩÍ≥†
    if (GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
      showCustomAlert(
        'error', 
        'ÏÑ§Ï†ï Ïò§Î•ò', 
        'Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.<br>(Google Apps Script URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§)'
      );
      return;
    }
    
    // üî• ÌóàÎãàÌåü Í≤ÄÏ¶ù (Î¥á Ï∞®Îã®)
    if (!validateHoneypot()) {

      return;
    }
    
    // üî• ÏµúÏÜå Ï≤¥Î•òÏãúÍ∞Ñ Í≤ÄÏ¶ù (Ïä§Ìå∏ Î∞©ÏßÄ)
    if (!checkMinimumStayTime()) {
      showCustomAlert(
        'error',
        'Ï†úÏ∂ú Ïã§Ìå®',
        'ÌéòÏù¥ÏßÄÏóê Îçî Î®∏Î¨ºÎü¨ Ï£ºÏã† ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'
      );
      return;
    }
    
    const formId = this.id;
    const formType = formId.replace('-form', '');
    
    // üî• Ïù¥Î©îÏùº Ï§ëÎ≥µ Ï†úÏ∂ú Í≤ÄÏ¶ù
    const emailInput = this.querySelector('input[type="email"]');
    if (emailInput && !checkResubmissionLimit(emailInput.value)) {
      showCustomAlert(
        'error',
        'Ï†úÏ∂ú Ï†úÌïú',
        'ÎèôÏùºÌïú Ïù¥Î©îÏùºÎ°úÎäî 2ÏãúÍ∞Ñ ÌõÑÏóê Îã§Ïãú Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî.'
      );
      return;
    }
    
    // üî• ÏµúÏ¢Ö Í≤ÄÏ¶ù ÌôïÏù∏
    const formState = formValidationStates[formType];
    const allValid = Object.values(formState).every(state => state === true);
    
    if (!allValid) {
      showCustomAlert(
        'error',
        'ÏûÖÎ†• Ïò§Î•ò',
        'Î™®Îì† ÌïÑÏàò Ìï≠Î™©ÏùÑ Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'
      );
      return;
    }
    
    // üî• Íµ¨ÏûÖ Í≤¨Ï†ÅÏÑú Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù
    if (formType === 'purchase' && (!selectedProducts.purchase || selectedProducts.purchase.length === 0)) {
      showCustomAlert(
        'error',
        'Ï†úÌíà ÏÑ†ÌÉù ÌïÑÏöî',
        'Í≤¨Ï†Å ÏöîÏ≤≠ÏùÑ ÏúÑÌï¥ ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅÏùò Ï†úÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.'
      );
      return;
    }
    
    // üî• Î†åÌÉà Í≤¨Ï†ÅÏÑú Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù (5Í∞ú Ïù¥ÏÉÅ ÏàòÎüâ ÌôïÏù∏)
    if (formType === 'rental') {
      if (!selectedProducts.rental || selectedProducts.rental.length === 0) {
        showCustomAlert(
          'error',
          'Ï†úÌíà ÏÑ†ÌÉù ÌïÑÏöî',
          'Î†åÌÉà Í≤¨Ï†Å ÏöîÏ≤≠ÏùÑ ÏúÑÌï¥ ÏµúÏÜå 5Í∞ú Ïù¥ÏÉÅÏùò Ï†úÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.'
        );
        return;
      }
      
      // Ï¥ù ÏàòÎüâ ÌôïÏù∏ (Í∞úÎ≥Ñ Ï†úÌíàÏùò quantity Ìï©ÏÇ∞)
      const totalQuantity = selectedProducts.rental.reduce((total, product) => {
        return total + product.quantity;
      }, 0);
      
      if (totalQuantity < 5) {
        showCustomAlert(
          'error',
          'Î†åÌÉà ÏàòÎüâ Î∂ÄÏ°±',
          'Î†åÌÉà Í≤¨Ï†Å ÏöîÏ≤≠ÏùÑ ÏúÑÌï¥ ÏµúÏÜå 5Í∞ú Ïù¥ÏÉÅÏùò Ï†úÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.<br>ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏàòÎüâ: ' + totalQuantity + 'Í∞ú'
        );
        return;
      }
    }
    
    window.isFormSubmitting = true;
    document.activeElement.blur();
    
    // Î°úÎî© ÌëúÏãú
    showLoadingModal();
    
    try {
      // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
      const formData = new FormData();
      
      // Í∏∞Î≥∏ Ï†ïÎ≥¥ ÏàòÏßë
      const nameInput = this.querySelector('input[name="name"]');
      const emailInput2 = this.querySelector('input[name="email"]');
      const phoneInput = this.querySelector('input[name="phone"]');
      
      formData.append('name', nameInput ? nameInput.value : '');
      formData.append('email', emailInput2 ? emailInput2.value : '');
      formData.append('phone', phoneInput ? phoneInput.value : '');
      
      // Î©îÏãúÏßÄ ÎÇ¥Ïö© ÎßåÎì§Í∏∞
      let message = '';
      
      // Ìèº ÌÉÄÏûÖÏóê Îî∞Îùº Î©îÏãúÏßÄ Íµ¨ÏÑ±
      if (formId === 'general-form') {
        // ÏùºÎ∞ò Î¨∏Ïùò
        const companyInput = this.querySelector('input[name="company"]');
        const inquirySelect = this.querySelector('select[name="inquiry-type"]');
        const messageTextarea = this.querySelector('textarea[name="message"]');
        
        message = `[ÏùºÎ∞ò Î¨∏Ïùò]\n`;
        if (companyInput && companyInput.value) {
          message += `ÌöåÏÇ¨Î™Ö: ${companyInput.value}\n`;
        }
        if (inquirySelect) {
          message += `Î¨∏Ïùò Ïú†Ìòï: ${inquirySelect.options[inquirySelect.selectedIndex].text}\n`;
        }
        message += `\nÎ¨∏Ïùò ÎÇ¥Ïö©:\n${messageTextarea ? messageTextarea.value : ''}`;
        
      } else if (formId === 'purchase-form') {
        // Íµ¨ÏûÖ Í≤¨Ï†ÅÏÑú
        const companyInput = this.querySelector('input[name="company"]');
        const budgetInput = this.querySelector('.gfnew-budget-input');
        const additionalTextarea = this.querySelector('textarea[name="additional-requests"]');
        
        message = `[Íµ¨ÏûÖ Í≤¨Ï†ÅÏÑú ÏöîÏ≤≠]\n`;
        if (companyInput && companyInput.value) {
          message += `ÌöåÏÇ¨Î™Ö: ${companyInput.value}\n`;
        }
        if (budgetInput && budgetInput.value) {
          message += `ÏòàÏÉÅ ÏòàÏÇ∞: ${budgetInput.value}\n`;
        }
        
        // ÏÑ†ÌÉùÎêú Ï†úÌíà Ï†ïÎ≥¥
        if (selectedProducts.purchase.length > 0) {
          message += `\nÏÑ†ÌÉùÎêú Ï†úÌíà (${selectedProducts.purchase.length}Ï¢Ö):\n`;
          selectedProducts.purchase.forEach((product, index) => {
            message += `${index + 1}. ${product.name} (${product.code}) - ÏàòÎüâ: ${product.quantity}Í∞ú\n`;
          });
          message += `Ï¥ù Íµ¨Îß§ Í∏àÏï°: ${formatNumber(calculateTotalPrice())}Ïõê\n`;
        }
        
        if (additionalTextarea && additionalTextarea.value) {
          message += `\nÏ∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠:\n${additionalTextarea.value}`;
        }
        
      } else if (formId === 'rental-form') {
        // üî• Î†åÌÉà Í≤¨Ï†ÅÏÑú - Î†åÌÉà Í∏∞Í∞ÑÎ≥Ñ Í∞ÄÍ≤© Ï†ïÎ≥¥ Ìè¨Ìï®
        const rentalPeriodSelect = this.querySelector('select[name="rental-period"]');
        const budgetInput = this.querySelector('.gfnew-budget-input');
        const additionalTextarea = this.querySelector('textarea[name="additional-requests"]');
        
        message = `[Î†åÌÉà Í≤¨Ï†ÅÏÑú ÏöîÏ≤≠]\n`;
        
        if (rentalPeriodSelect) {
          message += `Î†åÌÉà Í∏∞Í∞Ñ: ${rentalPeriodSelect.value}Í∞úÏõî\n`;
        }
        if (budgetInput && budgetInput.value) {
          message += `Ïõî Î†åÌÉà ÏòàÏÇ∞: ${budgetInput.value}\n`;
        }
        
        // ÏÑ†ÌÉùÎêú Ï†úÌíà Ï†ïÎ≥¥ (Î†åÌÉà Í∏∞Í∞ÑÎ≥Ñ Í∞ÄÍ≤© Ìè¨Ìï®)
        if (selectedProducts.rental.length > 0) {
          const currentPeriod = getCurrentRentalPeriod();
          message += `\nÏÑ†ÌÉùÎêú Ï†úÌíà (${selectedProducts.rental.length}Ï¢Ö, ${currentPeriod}Í∞úÏõî Í∏∞Ï§Ä):\n`;
          selectedProducts.rental.forEach((product, index) => {
            const originalPrice = product.originalRentalPrice || product.rentalPrice;
            const calculatedPrice = calculateRentalPrice(originalPrice, currentPeriod);
            message += `${index + 1}. ${product.name} (${product.code}) - ÏàòÎüâ: ${product.quantity}Í∞ú, Ïõî Î†åÌÉàÎ£å: ${formatNumber(calculatedPrice)}Ïõê\n`;
          });
          message += `Ïõî Î†åÌÉàÎ£å Ìï©Í≥Ñ: ${formatNumber(calculateTotalRentalPrice())}Ïõê\n`;
        }
        
        if (additionalTextarea && additionalTextarea.value) {
          message += `\nÏ∂îÍ∞Ä ÏöîÏ≤≠ÏÇ¨Ìï≠:\n${additionalTextarea.value}`;
        }
      }
      
      // message ÌååÎùºÎØ∏ÌÑ∞Ïóê Î™®Îì† ÎÇ¥Ïö© Îã¥Í∏∞
      formData.append('message', message);
      
      // üî•üî•üî• Î†åÌÉà ÌèºÏù∏ Í≤ΩÏö∞ ÌååÏùºÎì§ÏùÑ Base64Î°ú Î≥ÄÌôòÌïòÏó¨ Ï†ÑÏÜ°
      if (formId === 'rental-form' && rentalUploadedFiles && rentalUploadedFiles.length > 0) {
        // ÌååÏùº Í∞úÏàò Ï†ÑÏÜ°
        formData.append('fileCount', rentalUploadedFiles.length);
        
        // Í∞Å ÌååÏùºÏùÑ Base64Î°ú Î≥ÄÌôò
        for (let i = 0; i < rentalUploadedFiles.length; i++) {
          const file = rentalUploadedFiles[i];
          
          // FileReaderÎ•º ÏÇ¨Ïö©Ìï¥ Base64Î°ú Î≥ÄÌôò
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              // data:image/png;base64,xxxxx ÌòïÌÉúÏóêÏÑú base64 Î∂ÄÎ∂ÑÎßå Ï∂îÏ∂ú
              const base64String = reader.result.split(',')[1];
              resolve(base64String);
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
          
          // ÌååÏùº Ï†ïÎ≥¥ÏôÄ Base64 Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
          formData.append(`fileName_${i}`, file.name);
          formData.append(`fileType_${i}`, file.type);
          formData.append(`fileData_${i}`, base64);
        }
      }
      
      // Google Apps ScriptÎ°ú Ï†ÑÏÜ°
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: formData
      });
      
      const result = await response.text();
      
      // üî• Ï†úÏ∂ú ÏãúÍ∞Ñ Í∏∞Î°ù (Ïû¨Ï†úÏ∂ú Î∞©ÏßÄÏö©)
      if (emailInput2) {
        recordSubmissionTime(emailInput2.value);
      }
      
      // ÏÑ±Í≥µ Ï≤òÎ¶¨
      hideLoadingModal();
      showCustomAlert(
        'success',
        'Î¨∏Ïùò Ï†ëÏàò ÏôÑÎ£å!',
        'Î¨∏ÏùòÍ∞Ä Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.<br>Îπ†Î•∏ ÏãúÏùº ÎÇ¥Ïóê Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.'
      );
      
      // Ìèº Ï¥àÍ∏∞Ìôî
      form.reset();
      selectedProducts = {purchase: [], rental: []};
      tempSelectedProducts = [];
      
      // üî• ÌååÏùº Î™©Î°ù Ï¥àÍ∏∞Ìôî (Î†åÌÉà ÌèºÏù∏ Í≤ΩÏö∞)
      if (formId === 'rental-form') {
        rentalUploadedFiles = [];
        renderFileList();
      }
      
      // üî• Í≤ÄÏ¶ù ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
      Object.keys(formValidationStates[formType]).forEach(key => {
        if (key === 'phone' && formType === 'general') {
          formValidationStates[formType][key] = true; // ÏùºÎ∞òÎ¨∏Ïùò Ï†ÑÌôîÎ≤àÌò∏Îäî ÏÑ†ÌÉùÏÇ¨Ìï≠
        } else if (key === 'company') {
          formValidationStates[formType][key] = true; // ÌöåÏÇ¨Î™ÖÏùÄ ÏÑ†ÌÉùÏÇ¨Ìï≠
        } else {
          formValidationStates[formType][key] = false;
        }
      });
      
      // üî• Î™®Îì† ÌïÑÎìú ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
      const allFields = form.querySelectorAll('.gfnew-input, .gfnew-select, .gfnew-textarea');
      allFields.forEach(field => {
        field.classList.remove('error', 'valid');
      });
      
      // üî• Î™®Îì† Ïò§Î•ò Î©îÏãúÏßÄ Ïà®ÍπÄ
      const allErrors = form.querySelectorAll('.gfnew-error-message');
      allErrors.forEach(error => {
        error.classList.remove('show');
      });
      
      // ÏÑ†ÌÉùÎêú Ï†úÌíà Î™©Î°ù Ï¥àÍ∏∞Ìôî
      document.querySelectorAll('.gfnew-selected-list').forEach(list => {
        list.classList.remove('show');
        list.innerHTML = '';
      });

      // üî• Ï†úÌíà ÏÑ†ÌÉù ÏÑπÏÖò Ï¥àÍ∏∞Ìôî (Ï¥àÎ°ùÏÉâ Ï†úÍ±∞)
      document.querySelectorAll('.gfnew-product-section').forEach(section => {
        section.classList.remove('valid', 'error');
      });

      // üî• Ï†úÌíà ÏÑ†ÌÉù Î∞ïÏä§ ÏõêÎûò ÏÉâÏúºÎ°ú Î≥µÏõê
      document.querySelectorAll('.gfnew-product-add-box').forEach(box => {
        box.style.borderColor = '#e63946';
        box.style.background = 'transparent';
        box.style.color = '#e63946';
      });

      // üî• Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ Ï¥àÍ∏∞Ìôî
      const rentalGuide = document.getElementById('rental-guide');
      if (rentalGuide) {
        rentalGuide.classList.remove('show');
      }
      const rentalCount = document.getElementById('rental-current-count');
      if (rentalCount) {
        rentalCount.textContent = '0';
        rentalCount.classList.remove('sufficient');
      }
      
      // ÏòàÏÇ∞ ÎπÑÍµê ÏÑπÏÖò Ïà®Í∏∞Í∏∞
      const purchaseBudget = document.getElementById('purchase-budget-compare');
      const rentalBudget = document.getElementById('rental-budget-compare');
      if (purchaseBudget) purchaseBudget.style.display = 'none';
      if (rentalBudget) rentalBudget.style.display = 'none';
      
      // üî• Ï†úÏ∂ú Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
      updateSubmitButton(formType);
      
    } catch (error) {
      // ÏóêÎü¨ Ï≤òÎ¶¨
      hideLoadingModal();
      console.error('Error:', error);
      showCustomAlert(
        'error',
        'Ï†ÑÏÜ° Ïã§Ìå®',
        'Î¨∏Ïùò Ï†ÑÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.<br>Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.'
      );
    } finally {
      setTimeout(() => {
        window.isFormSubmitting = false;
      }, 100);
    }
  });
});

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                         UTILITY FUNCTIONS                                 ‚ñà‚ñà
‚ñà‚ñà                            Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò                                     ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ïà´Ïûê Ìè¨Îß∑ÌåÖ Ìï®Ïàò
function formatNumber(num) {
  return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// Ïà´ÏûêÎßå Ï∂îÏ∂úÌïòÎäî Ìï®Ïàò
function extractNumber(str) {
  return parseInt(str.replace(/[^0-9]/g, '')) || 0;
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FORM VALIDATION FUNCTIONS                              ‚ñà‚ñà
‚ñà‚ñà                    Ìèº Í≤ÄÏ¶ù Ìï®ÏàòÎì§ (ÏÉàÎ°ú Ï∂îÍ∞Ä)                                ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Ïä§Ìå∏ Î∞©ÏßÄ: Ï≤¥Î•òÏãúÍ∞Ñ ÌôïÏù∏
function checkMinimumStayTime() {
  const currentTime = Date.now();
  const stayTime = currentTime - pageLoadTime;
  return stayTime >= 30000; // 30Ï¥à Ïù¥ÏÉÅ
}

// üî• Ïä§Ìå∏ Î∞©ÏßÄ: Ïû¨Ï†úÏ∂ú ÌôïÏù∏
function checkResubmissionLimit(email) {
  const lastSubmitKey = `lastSubmit_${email}`;
  const lastSubmitTime = localStorage.getItem(lastSubmitKey);
  
  if (lastSubmitTime) {
    const timeDiff = Date.now() - parseInt(lastSubmitTime);
    const twoHours = 2 * 60 * 60 * 1000; // 2ÏãúÍ∞Ñ
    return timeDiff >= twoHours;
  }
  
  return true; // Ï≤´ Ï†úÏ∂úÏù¥Î©¥ ÌóàÏö©
}

// üî• Ïû¨Ï†úÏ∂ú ÏãúÍ∞Ñ Í∏∞Î°ù
function recordSubmissionTime(email) {
  const lastSubmitKey = `lastSubmit_${email}`;
  localStorage.setItem(lastSubmitKey, Date.now().toString());
}

// üî• ÌóàÎãàÌåü Í≤ÄÏ¶ù
function validateHoneypot() {
  const honeypot = document.getElementById('honeypot');
  return !honeypot || honeypot.value === '';
}

// üî• Ïù¥Î¶Ñ Í≤ÄÏ¶ù (ÌïúÍ∏Ä, ÏòÅÎ¨∏, Í≥µÎ∞±Îßå ÌóàÏö©)
function validateName(name) {
  if (!name || name.trim() === '') {
    return { valid: false, message: 'Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' };
  }
  
  // ÌïúÍ∏Ä, ÏòÅÎ¨∏, Í≥µÎ∞±Îßå ÌóàÏö©
  const nameRegex = /^[Í∞Ä-Ìû£a-zA-Z\s]+$/;
  if (!nameRegex.test(name)) {
    return { valid: false, message: 'Ïù¥Î¶ÑÏùÄ ÌïúÍ∏Ä, ÏòÅÎ¨∏, Í≥µÎ∞±Îßå ÏûÖÎ†• Í∞ÄÎä•Ìï©ÎãàÎã§.' };
  }
  
  if (name.trim().length < 2) {
    return { valid: false, message: 'Ïù¥Î¶ÑÏùÄ ÏµúÏÜå 2Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' };
  }
  
  return { valid: true, message: '' };
}

// üî• Ïù¥Î©îÏùº Í≤ÄÏ¶ù (ÌòïÏãù Í≤ÄÏ¶ùÎßå, ÎèÑÎ©îÏù∏ Ï†úÌïú ÏóÜÏùå)
function validateEmail(email) {
  if (!email || email.trim() === '') {
    return { valid: false, message: 'Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' };
  }
  
  // Í∏∞Î≥∏ Ïù¥Î©îÏùº ÌòïÏãù Í≤ÄÏ¶ùÎßå ÏàòÌñâ
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    return { valid: false, message: 'Ïò¨Î∞îÎ•∏ Ïù¥Î©îÏùº ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.' };
  }
  
  // Î™®Îì† ÎèÑÎ©îÏù∏ ÌóàÏö©
  return { valid: true, message: '' };
}

// üî• Ïò§Î•ò Î©îÏãúÏßÄ ÌëúÏãú/Ïà®ÍπÄ
function showError(elementId, message) {
  const errorElement = document.getElementById(elementId);
  if (errorElement) {
    errorElement.textContent = message;
    errorElement.classList.add('show');
  }
}

function hideError(elementId) {
  const errorElement = document.getElementById(elementId);
  if (errorElement) {
    errorElement.classList.remove('show');
  }
}

// üî• ÏûÖÎ†• ÌïÑÎìú ÏÉÅÌÉú Î≥ÄÍ≤Ω
function setFieldState(field, isValid) {
  if (!field) return;
  
  field.classList.remove('error', 'valid');
  if (isValid) {
    field.classList.add('valid');
  } else {
    field.classList.add('error');
  }
}

// üî• Ï†úÏ∂ú Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
function updateSubmitButton(formType) {
  const submitButton = document.getElementById(`${formType}-submit`);
  if (!submitButton) return;
  
  const formState = formValidationStates[formType];
  const allValid = Object.values(formState).every(state => state === true);
  
  submitButton.disabled = !allValid;
}

// üî• Ïã§ÏãúÍ∞Ñ Í≤ÄÏ¶ù Ìï®Ïàò - Î†åÌÉà Í∏∞Í∞Ñ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
function setupRealTimeValidation() {
  // Î™®Îì† ÌèºÏóê ÎåÄÌï¥ Ïã§ÏãúÍ∞Ñ Í≤ÄÏ¶ù ÏÑ§Ï†ï
  ['general', 'purchase', 'rental'].forEach(formType => {
    const form = document.getElementById(`${formType}-form`);
    if (!form) return;
    
    // Ïù¥Î¶Ñ Í≤ÄÏ¶ù
    const nameField = form.querySelector('input[name="name"]');
    if (nameField) {
      nameField.addEventListener('input', function() {
        const result = validateName(this.value);
        formValidationStates[formType].name = result.valid;
        
        if (result.valid) {
          hideError(`${formType}-name-error`);
          setFieldState(this, true);
        } else {
          showError(`${formType}-name-error`, result.message);
          setFieldState(this, false);
        }
        
        updateSubmitButton(formType);
      });
    }
    
    // Ïù¥Î©îÏùº Í≤ÄÏ¶ù
    const emailField = form.querySelector('input[name="email"]');
    if (emailField) {
      emailField.addEventListener('input', function() {
        const result = validateEmail(this.value);
        formValidationStates[formType].email = result.valid;
        
        if (result.valid) {
          hideError(`${formType}-email-error`);
          setFieldState(this, true);
        } else {
          showError(`${formType}-email-error`, result.message);
          setFieldState(this, false);
        }
        
        updateSubmitButton(formType);
      });
    }

    // ‚úÖ Ïù¥ ÏΩîÎìúÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÍ≥†, ÏóÜÏúºÎ©¥ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî
    // üî• Î†åÌÉà Í∏∞Í∞Ñ Í≤ÄÏ¶ù (Î†åÌÉàÎßå) - ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ
    if (formType === 'rental') {
      const periodField = form.querySelector('select[name="rental-period"]');
      if (periodField) {
        periodField.addEventListener('change', function() {
          const hasValue = this.value !== '';
          formValidationStates[formType].rentalPeriod = hasValue;
          
          if (hasValue) {
            hideError(`${formType}-period-error`);
            setFieldState(this, true);
          } else {
            showError(`${formType}-period-error`, 'Î†åÌÉà Í∏∞Í∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
            setFieldState(this, false);
          }
          
          // üî• Î†åÌÉà Í∏∞Í∞Ñ Î≥ÄÍ≤Ω Ïãú Î™®Îì† Ï†úÌíà Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
          updateAllRentalPrices();
          
          updateSubmitButton(formType);
        });
      }
    }
    
      // Ï†ÑÌôîÎ≤àÌò∏ Í≤ÄÏ¶ù (Î™®Îì† ÌèºÏóêÏÑú ÌïÑÏàò) - üî• ÏàòÏ†ïÎê®
      const phoneField = form.querySelector('input[name="phone"]');
      if (phoneField) {  // üî• Ï°∞Í±¥ Ï†úÍ±∞ - Î™®Îì† ÌèºÏóêÏÑú Í≤ÄÏ¶ù
      phoneField.addEventListener('input', function() {
        const hasValue = this.value.trim() !== '';
        formValidationStates[formType].phone = hasValue;
        
        if (hasValue) {
          hideError(`${formType}-phone-error`);
          setFieldState(this, true);
        } else {
          showError(`${formType}-phone-error`, 'Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
          setFieldState(this, false);
        }
        
        updateSubmitButton(formType);
      });
    }



    
    // Î¨∏Ïùò Ïú†Ìòï Í≤ÄÏ¶ù (ÏùºÎ∞òÎ¨∏ÏùòÎßå)
    if (formType === 'general') {
      const inquiryField = form.querySelector('select[name="inquiry-type"]');
      if (inquiryField) {
        inquiryField.addEventListener('change', function() {
          const hasValue = this.value !== '';
          formValidationStates[formType].inquiryType = hasValue;
          
          if (hasValue) {
            hideError(`${formType}-inquiry-type-error`);
            setFieldState(this, true);
          } else {
            showError(`${formType}-inquiry-type-error`, 'Î¨∏Ïùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
            setFieldState(this, false);
          }
          
          updateSubmitButton(formType);
        });
      }
      
      // Î¨∏Ïùò ÎÇ¥Ïö© Í≤ÄÏ¶ù
      const messageField = form.querySelector('textarea[name="message"]');
      if (messageField) {
        messageField.addEventListener('input', function() {
          const hasValue = this.value.trim() !== '';
          formValidationStates[formType].message = hasValue;
          
          if (hasValue) {
            hideError(`${formType}-message-error`);
            setFieldState(this, true);
          } else {
            showError(`${formType}-message-error`, 'Î¨∏Ïùò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
            setFieldState(this, false);
          }
          
          updateSubmitButton(formType);
        });
      }
    }
    
    // Í∞úÏù∏Ï†ïÎ≥¥ ÎèôÏùò Í≤ÄÏ¶ù
    const privacyField = form.querySelector('input[name="privacy-agree"]');
    if (privacyField) {
      privacyField.addEventListener('change', function() {
        formValidationStates[formType].privacyAgree = this.checked;
        updateSubmitButton(formType);
      });
    }
  });
}

// üî• Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù (Íµ¨Îß§ 1Í∞ú Ïù¥ÏÉÅ, Î†åÌÉà 5Í∞ú Ïù¥ÏÉÅ + ÏïàÎÇ¥ Î¨∏Íµ¨)
function validateProductSelection(formType) {
  // formTypeÏù¥ ÏóÜÏúºÎ©¥ ÌòÑÏû¨ ÌôúÏÑ± ÌÉ≠ ÏÇ¨Ïö©
  if (!formType) {
    formType = currentFormType;
  }
  
  // ÏùºÎ∞ò Î¨∏ÏùòÎäî Ï†úÌíà ÏÑ†ÌÉùÏù¥ ÏóÜÏúºÎØÄÎ°ú Ï†úÏô∏
  if (formType === 'general') {
    return;
  }
  
  const hasProducts = selectedProducts[formType] && selectedProducts[formType].length > 0;
  
  // üî• Î†åÌÉàÏùÄ 5Í∞ú Ïù¥ÏÉÅ, Íµ¨Îß§Îäî 1Í∞ú Ïù¥ÏÉÅ ÌôïÏù∏
  let isValidCount = false;
  let errorMessage = '';
  
  if (formType === 'rental') {
    // Î†åÌÉà: Ï¥ù ÏàòÎüâ 5Í∞ú Ïù¥ÏÉÅ ÌôïÏù∏ (Í∞úÎ≥Ñ Ï†úÌíàÏùò quantity Ìï©ÏÇ∞)
    const totalQuantity = selectedProducts[formType].reduce((total, product) => {
      return total + product.quantity;
    }, 0);
    
    isValidCount = totalQuantity >= 5;
    errorMessage = isValidCount ? '' : 'Î†åÌÉà Í≤¨Ï†Å ÏöîÏ≤≠ÏùÑ ÏúÑÌï¥ ÏµúÏÜå 5Í∞ú Ïù¥ÏÉÅÏùò Ï†úÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.';
    
    // üî• Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ ÏóÖÎç∞Ïù¥Ìä∏
    updateRentalGuideMessage(totalQuantity, isValidCount);
    
  } else if (formType === 'purchase') {
    // Íµ¨Îß§: 1Í∞ú Ïù¥ÏÉÅ
    isValidCount = hasProducts;
    errorMessage = isValidCount ? '' : 'ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅÏùò Ï†úÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.';
  }
  
  formValidationStates[formType].products = isValidCount;
  
  // Ìï¥Îãπ ÌèºÏùò Ï†úÌíà ÏÑπÏÖò Ï∞æÍ∏∞
  const form = document.getElementById(`${formType}-form`);
  const productSection = form ? form.querySelector('.gfnew-product-section') : null;
  
  if (productSection) {
    productSection.classList.remove('error', 'valid');
    if (isValidCount) {
      productSection.classList.add('valid');
      hideError(`${formType}-products-error`);
    } else {
      productSection.classList.add('error');
      showError(`${formType}-products-error`, errorMessage);
    }
  }
  
  updateSubmitButton(formType);
}

// üî• Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉàÎ°ú Ï∂îÍ∞Ä)
function updateRentalGuideMessage(currentQuantity, isValid) {
  const guideElement = document.getElementById('rental-guide');
  const countElement = document.getElementById('rental-current-count');
  
  if (!guideElement || !countElement) return;
  
  // ÌòÑÏû¨ ÏàòÎüâ ÏóÖÎç∞Ïù¥Ìä∏
  countElement.textContent = currentQuantity;
  
  // ÏàòÎüâÏóê Îî∞Îùº ÏÉâÏÉÅ Î≥ÄÍ≤Ω
  countElement.classList.remove('sufficient');
  if (currentQuantity >= 5) {
    countElement.classList.add('sufficient');
  }
  
  // ÏïàÎÇ¥ Î¨∏Íµ¨ ÌëúÏãú/Ïà®ÍπÄ
  if (isValid) {
    // 5Í∞ú Ïù¥ÏÉÅÏù¥Î©¥ ÏïàÎÇ¥ Î¨∏Íµ¨ Ïà®ÍπÄ
    guideElement.classList.remove('show');
  } else {
    // 5Í∞ú ÎØ∏ÎßåÏù¥Î©¥ ÏïàÎÇ¥ Î¨∏Íµ¨ ÌëúÏãú
    guideElement.classList.add('show');
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FORM VALIDATION FUNCTIONS ÎÅù                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      BUDGET INPUT HANDLERS                                ‚ñà‚ñà
‚ñà‚ñà                         ÏòàÏÇ∞ ÏûÖÎ†• Ìï∏Îì§Îü¨                                    ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// ÏòàÏÇ∞ ÏûÖÎ†• Ïãú Ïã§ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ
document.addEventListener('DOMContentLoaded', function() {
  const purchaseBudget = document.getElementById('purchase-budget');
  const rentalBudget = document.getElementById('rental-budget');
  
  if (purchaseBudget) {
    purchaseBudget.addEventListener('input', function(e) {
      let value = e.target.value.replace(/[^0-9]/g, '');
      if (value) {
        e.target.value = formatNumber(value) + 'Ïõê';
      }
      const len = e.target.value.length;
      e.target.setSelectionRange(len - 1, len - 1);
    });
  }
  
  if (rentalBudget) {
    rentalBudget.addEventListener('input', function(e) {
      let value = e.target.value.replace(/[^0-9]/g, '');
      if (value) {
        e.target.value = formatNumber(value) + 'Ïõê';
      }
      const len = e.target.value.length;
      e.target.setSelectionRange(len - 1, len - 1);
    });
  }
});

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                     QUOTATION CART IMPORT (ÏàòÏ†ïÎê®)                        ‚ñà‚ñà
‚ñà‚ñà                        Í≤¨Ï†ÅÌï® Î∂àÎü¨Ïò§Í∏∞ Í∏∞Îä•                                  ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Í≤¨Ï†ÅÌï®ÏóêÏÑú Ï†úÌíà Î∂àÎü¨Ïò§Í∏∞
function loadFromQuotationCart() {
  const urlParams = new URLSearchParams(window.location.search);
  const fromTab = urlParams.get('tab');
  
  const savedCart = localStorage.getItem('gofitQuotation');
  if (!savedCart) return;
  
  try {
    const cartItems = JSON.parse(savedCart);
    if (cartItems.length === 0) return;
    
    if (fromTab === 'purchase') {
      const purchaseTab = document.querySelector('.gfnew-tab[onclick*="purchase"]');
      if (purchaseTab) {
        purchaseTab.click();
      }
      
      setTimeout(() => {
        cartItems.forEach(item => {
          const product = GOFIT_PRODUCTS.find(p => p.id === item.id);
          if (product) {
            selectedProducts.purchase.push({...product, quantity: 1});
          }
        });
        
        currentFormType = 'purchase';
        renderSelectedProducts();
        
        // üî• Ï∂îÍ∞ÄÎê®: ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú ÏóÖÎç∞Ïù¥Ìä∏
        updateBudgetComparison();
        
        // üî• Ï∂îÍ∞ÄÎê®: Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù
        validateProductSelection('purchase');
        
        showImportNotification(cartItems.length, 'Íµ¨ÏûÖ');
        
        if (confirm('Ï†úÌíàÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§. Í≤¨Ï†ÅÌï®ÏùÑ ÎπÑÏö∞ÏãúÍ≤†ÏäµÎãàÍπå?')) {
          localStorage.removeItem('gofitQuotation');
        }
      }, 500);
    } else if (fromTab === 'rental') {
      const rentalTab = document.querySelector('.gfnew-tab[onclick*="rental"]');
      if (rentalTab) {
        rentalTab.click();
      }
      
      setTimeout(() => {
        cartItems.forEach(item => {
          const product = GOFIT_PRODUCTS.find(p => p.id === item.id);
          if (product) {
            // üî• Î†åÌÉà Ï†úÌíàÏùÄ Í∏∞Î≥∏ 12Í∞úÏõî Í∏∞Ï§ÄÏúºÎ°ú Í∞ÄÍ≤© Í≥ÑÏÇ∞
            const productToAdd = {...product, quantity: 1};
            productToAdd.originalRentalPrice = product.rentalPrice; // ÏõêÎ≥∏ Í∞ÄÍ≤© Ï†ÄÏû•
            productToAdd.rentalPrice = calculateRentalPrice(product.rentalPrice, 12); // 12Í∞úÏõî Í∏∞Ï§Ä
            selectedProducts.rental.push(productToAdd);
          }
        });
        
        currentFormType = 'rental';
        renderSelectedProducts();
        
        // üî• Ï∂îÍ∞ÄÎê®: Î†åÌÉà ÏòàÏÉÅ Í≤¨Ï†ÅÏÑú ÏóÖÎç∞Ïù¥Ìä∏
        updateRentalBudgetComparison();
        
        // üî• Ï∂îÍ∞ÄÎê®: Ï†úÌíà ÏÑ†ÌÉù Í≤ÄÏ¶ù
        validateProductSelection('rental');
        
        showImportNotification(cartItems.length, 'Î†åÌÉà');
        
        if (confirm('Ï†úÌíàÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§. Í≤¨Ï†ÅÌï®ÏùÑ ÎπÑÏö∞ÏãúÍ≤†ÏäµÎãàÍπå?')) {
          localStorage.removeItem('gofitQuotation');
        }
      }, 500);
    }
  } catch (e) {
    console.error('Í≤¨Ï†ÅÌï® Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
  }
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                     QUOTATION CART IMPORT ÎÅù                              ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å ÏïåÎ¶º
function showImportNotification(count, type = 'Íµ¨ÏûÖ') {
  const notification = document.createElement('div');
  notification.className = 'gfnew-import-notification';
  notification.innerHTML = `
    <i class="fas fa-check-circle"></i>
    <span>Í≤¨Ï†ÅÌï®ÏóêÏÑú ${count}Í∞úÏùò Ï†úÌíàÏùÑ ${type} Í≤¨Ï†ÅÏÑúÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§.</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 10);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, 4000);
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                      PAGE LEAVE WARNING                                   ‚ñà‚ñà
‚ñà‚ñà                         ÌéòÏù¥ÏßÄ Ïù¥ÌÉà Í≤ΩÍ≥†                                     ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// ÌéòÏù¥ÏßÄ Ïù¥ÌÉà Í≤ΩÍ≥† Í∏∞Îä•
function setupPageLeaveWarning() {
  window.addEventListener('beforeunload', function(e) {
    if (window.isFormSubmitting) {
      return;
    }
    
    const hasData = checkIfFormHasData();
    
    if (hasData) {
      const message = 'ÏûëÏÑ± Ï§ëÏù∏ Í≤¨Ï†ÅÏÑúÍ∞Ä ÏûàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÎÇòÍ∞ÄÏãúÎ©¥ ÏûëÏÑ±ÌïòÏã† ÎÇ¥Ïö©Ïù¥ Î™®Îëê ÏÇ¨ÎùºÏßëÎãàÎã§. Ï†ïÎßê ÎÇòÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå?';
      e.preventDefault();
      e.returnValue = message;
      return message;
    }
  });
}

// ÌèºÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Ìï®Ïàò
function checkIfFormHasData() {
  const activeForm = document.querySelector('.gfnew-form-panel.active');
  if (!activeForm) return false;
  
  const inputs = activeForm.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
  for (let input of inputs) {
    if (input.value.trim() !== '') {
      return true;
    }
  }
  
  const selects = activeForm.querySelectorAll('select');
  for (let select of selects) {
    if (select.value !== '' && select.selectedIndex !== 0) {
      return true;
    }
  }
  
  if (activeTab === 'purchase' && selectedProducts.purchase.length > 0) {
    return true;
  }
  if (activeTab === 'rental' && selectedProducts.rental.length > 0) {
    return true;
  }
  
  const checkboxes = activeForm.querySelectorAll('input[type="checkbox"]:checked');
  if (checkboxes.length > 0) {
    return true;
  }
  
  return false;
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    URL ÌååÎùºÎØ∏ÌÑ∞ ÏûêÎèô ÏûÖÎ†• Í∏∞Îä• (ÏàòÏ†ïÎê®)                       ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/**
 * URL ÌååÎùºÎØ∏ÌÑ∞Î•º ÏùΩÏñ¥ÏÑú ÏûêÎèôÏúºÎ°ú Ìèº ÏûÖÎ†•ÌïòÎäî Ìï®Ïàò
 */
function handleURLParameters() {
  const urlParams = new URLSearchParams(window.location.search);
  const tab = urlParams.get('tab');
  const productName = urlParams.get('product');
  
  // üî• ÌÉ≠Ïù¥ ÏßÄÏ†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò üî•
  if (tab) {
    const tabButtons = document.querySelectorAll('.gfnew-tab');
    let targetButton = null;
    
    tabButtons.forEach(button => {
      const buttonText = button.textContent.trim();
      if (
        (tab === 'general' && buttonText === 'ÏùºÎ∞ò Î¨∏Ïùò') ||
        (tab === 'purchase' && buttonText === 'Íµ¨ÏûÖ Í≤¨Ï†ÅÏÑú') ||
        (tab === 'rental' && buttonText === 'Î†åÌÉà Í≤¨Ï†ÅÏÑú')
      ) {
        targetButton = button;
      }
    });
    
    // Ìï¥Îãπ ÌÉ≠ÏúºÎ°ú Ï†ÑÌôò
    if (targetButton) {
      setTimeout(() => {
        targetButton.click();
        
        // üî• Ï†úÌíàÎ™ÖÏù¥ ÏûàÏúºÎ©¥ Î¨∏Ïùò ÎÇ¥Ïö©Ïóê ÏûêÎèô ÏûÖÎ†• üî•
        if (productName && tab === 'general') {
          setTimeout(() => {
            const textarea = document.querySelector('#general-form .gfnew-textarea');
            if (textarea) {
              const decodedProductName = decodeURIComponent(productName);
              textarea.value = `<${decodedProductName} Î¨∏Ïùò ÏÇ¨Ìï≠Ïù¥ ÏûàÏñ¥Ïöî!>\n\n`;
              
              // üî• ÏàòÏ†ïÎê®: PCÏóêÏÑúÎßå Ìè¨Ïª§Ïä§, Î™®Î∞îÏùºÏóêÏÑúÎäî ÌÇ§Î≥¥Îìú Î∞©ÏßÄ üî•
              if (window.innerWidth > 768) {
                textarea.focus();
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
              } else {
                // üî• Î™®Î∞îÏùºÏóêÏÑúÎäî Ìè¨Ïª§Ïä§ ÏóÜÏù¥ Ïª§ÏÑúÎßå ÎÅùÏúºÎ°ú Ïù¥Îèô üî•
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
              }
              
              showAutoFillNotification(decodedProductName);
            }
          }, 300);
        }
      }, 100);
    }
  }
}

/**
 * ÏûêÎèô ÏûÖÎ†• ÏôÑÎ£å ÏïåÎ¶ºÏùÑ ÌëúÏãúÌïòÎäî Ìï®Ïàò
 */
function showAutoFillNotification(productName) {
  const notification = document.createElement('div');
  notification.className = 'gfnew-autofill-notification';
  notification.innerHTML = `
    <i class="fas fa-check-circle"></i>
    <span>"${productName}" Ï†úÌíà Î¨∏Ïùò ÎÇ¥Ïö©Ïù¥ ÏûêÎèôÏúºÎ°ú ÏûÖÎ†•ÎêòÏóàÏäµÎãàÎã§.</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 10);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.remove();
      }
    }, 300);
  }, 4000);
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    URL ÌååÎùºÎØ∏ÌÑ∞ ÏûêÎèô ÏûÖÎ†• Í∏∞Îä• ÏàòÏ†ï ÎÅù                        ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

function init() {

  
  loadContactProducts();
  setupContactScrollAnimations();
  loadFromQuotationCart();
  setupPageLeaveWarning();
  
  // üî• URL ÌååÎùºÎØ∏ÌÑ∞ Ï≤òÎ¶¨ Ï∂îÍ∞Ä üî•
  handleURLParameters();
  
  // üî• Ïã§ÏãúÍ∞Ñ Í≤ÄÏ¶ù ÏÑ§Ï†ï (ÏÉàÎ°ú Ï∂îÍ∞Ä)
  setupRealTimeValidation();
  
  // üî• Î™®Îì† Ï†úÏ∂ú Î≤ÑÌäº Ï¥àÍ∏∞ ÏÉÅÌÉúÎ•º ÎπÑÌôúÏÑ±ÌôîÎ°ú ÏÑ§Ï†ï
  ['general', 'purchase', 'rental'].forEach(formType => {
    updateSubmitButton(formType);
  });
  
  // üÜï Ï£ºÏöî Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨ Î°úÎìú (ÏÑ±Îä• Í∞úÏÑ†)
  preloadImportantImages();
  
  // üî• ÌååÏùº ÏóÖÎ°úÎìú Í∏∞Îä• Ï¥àÍ∏∞Ìôî (ÏÉàÎ°ú Ï∂îÍ∞Ä)
  initializeFileUpload();
  
  // üî• Î†åÌÉà ÏïàÎÇ¥ Î¨∏Íµ¨ Ï¥àÍ∏∞ ÏÑ§Ï†ï (Í∏∞Ï°¥ ÏΩîÎìú Îí§Ïóê Ï∂îÍ∞Ä)
  // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌòÑÏû¨ ÌôúÏÑ± ÌÉ≠Ïù¥ Î†åÌÉàÏù¥Î©¥ ÏïàÎÇ¥ Î¨∏Íµ¨ ÌëúÏãú
  setTimeout(() => {
    if (activeTab === 'rental') {
      const totalQuantity = selectedProducts.rental.reduce((total, product) => {
        return total + product.quantity;
      }, 0);
      updateRentalGuideMessage(totalQuantity, totalQuantity >= 5);
    }
  }, 500); // ÌÉ≠ Ï†ÑÌôò Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÎ£å ÌõÑ Ïã§Ìñâ
  

}

// DOM Î°úÎìú ÏôÑÎ£å Ïãú Ïã§Ìñâ
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                           Ï¥àÍ∏∞Ìôî Ìï®Ïàò ÏàòÏ†ï ÎÅù                                ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                       GLOBAL FUNCTION EXPORT                              ‚ñà‚ñà
‚ñà‚ñà                         Ï†ÑÏó≠ Ìï®Ïàò Îì±Î°ù                                      ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// Ï†ÑÏó≠ Ìï®Ïàò Îì±Î°ù
window.showTab = showTab;
window.openProductModal = openProductModal;
window.closeProductModal = closeProductModal;
window.filterProducts = filterProducts;
window.toggleProduct = toggleProduct;
window.confirmSelection = confirmSelection;
window.changeQuantity = changeQuantity;
window.removeProduct = removeProduct;
window.updateBudgetComparison = updateBudgetComparison;
window.updateRentalBudgetComparison = updateRentalBudgetComparison;
window.loadMoreProducts = loadMoreProducts;

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FILE UPLOAD FUNCTIONALITY                              ‚ñà‚ñà
‚ñà‚ñà                    ÌååÏùº ÏóÖÎ°úÎìú Í∏∞Îä• (ÏÉàÎ°ú Ï∂îÍ∞Ä)                             ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/

// üî• Î†åÌÉà Ìèº ÏóÖÎ°úÎìúÎêú ÌååÏùºÎì§ Ï†ÄÏû• Î∞∞Ïó¥
let rentalUploadedFiles = [];

// üî• ÌååÏùº ÏóÖÎ°úÎìú Ï¥àÍ∏∞Ìôî Ìï®Ïàò
function initializeFileUpload() {
  const fileInput = document.getElementById('rental-file-input');
  const dropZone = document.querySelector('.gfnew-file-drop-zone');
  const fileList = document.getElementById('rental-file-list');
  
  if (!fileInput || !dropZone || !fileList) return;
  
  // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
  fileInput.addEventListener('change', handleFileSelect);
  
  // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏
  dropZone.addEventListener('dragover', handleDragOver);
  dropZone.addEventListener('dragleave', handleDragLeave);
  dropZone.addEventListener('drop', handleFileDrop);
  

}

// üî• ÌååÏùº ÏÑ†ÌÉù Ï≤òÎ¶¨
function handleFileSelect(event) {
  const files = Array.from(event.target.files);
  processSelectedFiles(files);
}

// üî• ÎìúÎûòÍ∑∏ Ïò§Î≤Ñ Ï≤òÎ¶¨
function handleDragOver(event) {
  event.preventDefault();
  event.currentTarget.classList.add('dragover');
}

// üî• ÎìúÎûòÍ∑∏ Î¶¨Î∏å Ï≤òÎ¶¨
function handleDragLeave(event) {
  event.preventDefault();
  event.currentTarget.classList.remove('dragover');
}

// üî• ÌååÏùº ÎìúÎ°≠ Ï≤òÎ¶¨
function handleFileDrop(event) {
  event.preventDefault();
  event.currentTarget.classList.remove('dragover');
  
  const files = Array.from(event.dataTransfer.files);
  processSelectedFiles(files);
}

// üî• ÏÑ†ÌÉùÎêú ÌååÏùºÎì§ Ï≤òÎ¶¨
function processSelectedFiles(newFiles) {
  // ÌååÏùº Í∞úÏàò Ï†úÌïú ÌôïÏù∏ (ÏµúÎåÄ 5Í∞ú)
  const totalFiles = rentalUploadedFiles.length + newFiles.length;
  if (totalFiles > 5) {
    showCustomAlert(
      'error',
      'ÌååÏùº Í∞úÏàò Ï¥àÍ≥º',
      `ÏµúÎåÄ 5Í∞ú ÌååÏùºÍπåÏßÄÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.<br>ÌòÑÏû¨: ${rentalUploadedFiles.length}Í∞ú, Ï∂îÍ∞ÄÌïòÎ†§Îäî ÌååÏùº: ${newFiles.length}Í∞ú`
    );
    return;
  }
  
  // Í∞Å ÌååÏùº Í≤ÄÏ¶ù Î∞è Ï∂îÍ∞Ä
  newFiles.forEach(file => {
    if (validateFile(file)) {
      rentalUploadedFiles.push(file);
    }
  });
  
  // ÌååÏùº Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
  renderFileList();
  
  // Í≤ÄÏ¶ù ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
  validateFileSelection();
  
  // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùº Ïû¨ÏÑ†ÌÉù Í∞ÄÎä•ÌïòÍ≤å)
  const fileInput = document.getElementById('rental-file-input');
  if (fileInput) fileInput.value = '';
}

// üî• Í∞úÎ≥Ñ ÌååÏùº Í≤ÄÏ¶ù
function validateFile(file) {
  // ÌååÏùº ÌòïÏãù Í≤ÄÏ¶ù
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'];
  if (!allowedTypes.includes(file.type)) {
    showCustomAlert(
      'error',
      'ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù',
      `${file.name}<br>JPG, PNG, GIF, PDF ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.`
    );
    return false;
  }
  
  // ÌååÏùº ÌÅ¨Í∏∞ Í≤ÄÏ¶ù (10MB)
  const maxSize = 10 * 1024 * 1024; // 10MB
  if (file.size > maxSize) {
    showCustomAlert(
      'error',
      'ÌååÏùº ÌÅ¨Í∏∞ Ï¥àÍ≥º',
      `${file.name}<br>ÌååÏùº ÌÅ¨Í∏∞Îäî 10MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.<br>ÌòÑÏû¨ ÌÅ¨Í∏∞: ${formatFileSize(file.size)}`
    );
    return false;
  }
  
  // Ï§ëÎ≥µ ÌååÏùº Í≤ÄÏ¶ù
  const isDuplicate = rentalUploadedFiles.some(existingFile => 
    existingFile.name === file.name && existingFile.size === file.size
  );
  
  if (isDuplicate) {
    showCustomAlert(
      'error',
      'Ï§ëÎ≥µ ÌååÏùº',
      `${file.name}<br>Ïù¥ÎØ∏ ÏóÖÎ°úÎìúÎêú ÌååÏùºÏûÖÎãàÎã§.`
    );
    return false;
  }
  
  return true;
}

// üî• ÌååÏùº Î™©Î°ù Î†åÎçîÎßÅ
function renderFileList() {
  const fileList = document.getElementById('rental-file-list');
  if (!fileList) return;
  
  if (rentalUploadedFiles.length === 0) {
    fileList.style.display = 'none';
    fileList.classList.remove('show');
    return;
  }
  
  fileList.style.display = 'block';
  fileList.classList.add('show');
  
  fileList.innerHTML = rentalUploadedFiles.map((file, index) => {
    const fileIcon = getFileIcon(file.type);
    const fileSize = formatFileSize(file.size);
    
    return `
      <div class="gfnew-file-item">
        <div class="gfnew-file-icon">
          <i class="${fileIcon}"></i>
        </div>
        <div class="gfnew-file-info">
          <div class="gfnew-file-name">${file.name}</div>
          <div class="gfnew-file-size">${fileSize}</div>
        </div>
        <button type="button" class="gfnew-file-remove" onclick="removeFile(${index})">
          <i class="fas fa-times"></i>
        </button>
      </div>
    `;
  }).join('');
}

// üî• ÌååÏùº ÏïÑÏù¥ÏΩò Í≤∞Ï†ï
function getFileIcon(fileType) {
  if (fileType.startsWith('image/')) {
    return 'fas fa-image';
  } else if (fileType === 'application/pdf') {
    return 'fas fa-file-pdf';
  } else {
    return 'fas fa-file';
  }
}

// üî• ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑ÌåÖ
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// üî• ÌååÏùº ÏÇ≠Ï†ú
function removeFile(index) {
  rentalUploadedFiles.splice(index, 1);
  renderFileList();
  validateFileSelection();
}

// üî• ÌååÏùº ÏÑ†ÌÉù Í≤ÄÏ¶ù (ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥ÎØÄÎ°ú Ìï≠ÏÉÅ true)
function validateFileSelection() {
  // ÌååÏùº ÏóÖÎ°úÎìúÎäî ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥ÎØÄÎ°ú Ìï≠ÏÉÅ Ïú†Ìö®
  // ÌïòÏßÄÎßå Ìñ•ÌõÑ ÌïÑÏàòÎ°ú Î≥ÄÍ≤ΩÌï† Í≤ΩÏö∞Î•º ÎåÄÎπÑÌï¥ Ìï®ÏàòÎäî Ïú†ÏßÄ

  return true;
}

/*
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà                    FILE UPLOAD FUNCTIONALITY ÎÅù                           ‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
*/